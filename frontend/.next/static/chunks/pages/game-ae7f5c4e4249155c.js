(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{134:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return l(9669)}])},3874:function(e,t){"use strict";t.Z={src:"/_next/static/media/logo.174882b4.png",height:1024,width:1024,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAwElEQVR42mMQllESlVMRk1MRl1cVAyI5FVFZJWEZZQYRWWUOMTkeCXkGASkGfilGUTlOGWURGSUGXkkFdV19RXVtIzNzYwtLfX19dQVFPqAOIJg4sWvFivlr1y5ZunLR6lk9rY4MDOKaQHHu6Jionp62jo7mtvamrvaGUDc7BnYJBj5JBQkFVStbOwsbWysbW2sHR0ktA34JeZDlgtJKDDwgJUALGTjFBCXkgYIMQjJKQEpcQVVcHoSADCBXWEYJABn5I+WumxzZAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}},9669:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return game}});var o=l(5893),n=l(7294),a=l(1163),s=l(4306),components_GameGrid=e=>{let{guesses:t,currentGuess:l,setCurrentGuess:a,onGuess:s,remainingGuesses:i,targetWord:r}=e,[u,c]=(0,n.useState)([]),calculateHintColors=(e,t)=>{let l=[,,,,,].fill("bg-white/10 border-white/30 text-white"),o=t.split(""),n=e.split("");for(let e=0;e<5;e++)n[e]===o[e]&&(l[e]="bg-green-500 border-green-500 text-white",o[e]="*");for(let e=0;e<5;e++)if("bg-white/10 border-white/30 text-white"===l[e]){let t=o.indexOf(n[e]);-1!==t&&(l[e]="bg-yellow-500 border-yellow-500 text-white",o[t]="*")}return l};(0,n.useEffect)(()=>{if(r&&t.length>0){let e=t.map(e=>calculateHintColors(e,r));c(e)}},[t,r]);let handleSubmit=async()=>{5!==l.length||i<=0||(await s(l.toUpperCase()),a(""))};return(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center w-full",children:[(0,o.jsx)("div",{className:"flex flex-col gap-3 items-center mb-6",children:[...Array(7)].map((e,l)=>{let n=t[l]||"";t.length;let a=u[l]||[];return(0,o.jsx)("div",{className:"flex gap-3 justify-center",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let l="w-14 h-14 flex items-center justify-center border-2 rounded-full text-2xl font-bold transition-all duration-200",s="";return n?(l+=" ".concat(a[t]||"bg-white/10 border-white/30 text-white"),s=n[t]||""):(l+=" bg-white/5 border-white/20 text-white/50",s=""),(0,o.jsx)("div",{className:l,style:{aspectRatio:"1 / 1"},children:s},t)})},l)})}),i>0&&(0,o.jsxs)("div",{className:"flex flex-col items-center gap-4 w-full max-w-md",children:[(0,o.jsxs)("div",{className:"text-accent text-lg font-semibold",children:["Guess ",7-i+1," of 7"]}),(0,o.jsxs)("div",{className:"flex gap-3 justify-center w-full",children:[(0,o.jsx)("input",{type:"text",maxLength:5,value:l,onChange:e=>{let t=e.target.value.replace(/[^A-Za-z]/g,"").toUpperCase();a(t)},className:"px-6 py-3 rounded-lg border-2 border-white/30 bg-white/10 text-white text-center text-xl font-semibold placeholder-white/50 focus:outline-none focus:border-accent",disabled:i<=0,onKeyDown:e=>{"Enter"===e.key&&5===l.length&&i>0&&handleSubmit()},placeholder:"Enter 5-letter word",autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"characters",spellCheck:"false",inputMode:"text",style:{fontSize:"16px"}}),(0,o.jsx)("button",{onClick:handleSubmit,className:"px-6 py-3 bg-accent text-primary rounded-lg font-bold text-lg hover:bg-yellow-400 hover:shadow-lg disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 active:scale-95 min-h-[48px] flex items-center justify-center",disabled:5!==l.length||i<=0,children:"Guess"})]})]})]})},i=l(5675),r=l.n(i),u=l(3874),c=l(960),d=l(1910),m=l(4155),game=()=>{let e=(0,a.useRouter)(),{publicKey:t,signTransaction:l,signAllTransactions:i}=(0,s.O)(),[p,g]=(0,n.useState)([]),[h,f]=(0,n.useState)(""),[v,y]=(0,n.useState)("playing"),[w,x]=(0,n.useState)(!1),[b,S]=(0,n.useState)(null),[j,E]=(0,n.useState)(""),[A,C]=(0,n.useState)(!0),[D,N]=(0,n.useState)(null),[R,G]=(0,n.useState)(0),[I,T]=(0,n.useState)(!1),[F,k]=(0,n.useState)(120),[P,L]=(0,n.useState)(!1),[W,_]=(0,n.useState)(""),[M,U]=(0,n.useState)(0),[O,B]=(0,n.useState)(null),[V,z]=(0,n.useState)(null),[Y,J]=(0,n.useState)(7),[X,Q]=(0,n.useState)(""),[Z,H]=(0,n.useState)("connected"),[q,K]=(0,n.useState)(!1),[$,ee]=(0,n.useState)(0),[et,el]=(0,n.useState)(!1),eo=(0,n.useRef)(),en=(0,n.useRef)(),ea={setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch(l){console.error("❌ localStorage.setItem failed for ".concat(e,":"),l);try{["oldMatchData","tempData"].forEach(e=>localStorage.removeItem(e)),localStorage.setItem(e,t)}catch(t){console.error("❌ localStorage retry failed for ".concat(e,":"),t),N("Storage error - game data may not be saved")}}},getItem:e=>{try{return localStorage.getItem(e)}catch(t){return console.error("❌ localStorage.getItem failed for ".concat(e,":"),t),null}},removeItem:e=>{try{localStorage.removeItem(e)}catch(t){console.error("❌ localStorage.removeItem failed for ".concat(e,":"),t)}}},es=(0,n.useCallback)(async(l,o,n)=>{if(console.log("\uD83C\uDFC1 handleGameEnd called:",{won:l,reason:o,customGuesses:n,isSubmittingResult:et,hasPlayerResult:!!b}),et){console.log("⏳ Already submitting result, ignoring duplicate call");return}el(!0),y("waiting"),console.log("\uD83C\uDFC1 Game ended:",{won:l,reason:o,customGuesses:n});let a=n||p,s=Date.now(),i="timeout"===o?12e4:$>0?s-$:12e4,r={won:l,numGuesses:a.length,totalTime:i,guesses:a,reason:o||"game_completed"};S(r);let submitResultWithRetry=async()=>{let e=null;for(let l=1;l<=3;l++)try{let e=await (0,d.u_)(j,(null==t?void 0:t.toString())||"",r);return e}catch(t){if(e=t,console.error("❌ Result submission failed (attempt ".concat(l,"):"),t),l<3)console.log("⏳ Retrying in ".concat(1e3*l,"ms...")),await new Promise(e=>setTimeout(e,1e3*l));else throw console.error("❌ All retry attempts failed"),t}throw e};try{let l=await submitResultWithRetry();if("completed"===l.status&&l.payout){var u,c,g,h,f,v,w,x,E,A;let o={won:l.winner===(null==t?void 0:t.toString()),isTie:"tie"===l.winner,winner:l.winner,numGuesses:r.numGuesses,entryFee:M,timeElapsed:"".concat(Math.floor(r.totalTime/1e3),"s"),opponentTimeElapsed:"N/A",opponentGuesses:0,winnerAmount:(null===(u=l.payout)||void 0===u?void 0:u.winnerAmount)||0,feeAmount:(null===(c=l.payout)||void 0===c?void 0:c.feeAmount)||0,refundAmount:(null===(g=l.payout)||void 0===g?void 0:g.refundAmount)||0,isWinningTie:(null===(h=l.payout)||void 0===h?void 0:h.isWinningTie)||!1,feeWallet:(null===(f=l.payout)||void 0===f?void 0:f.feeWallet)||"",transactions:(null===(v=l.payout)||void 0===v?void 0:v.transactions)||[],automatedPayout:(null===(w=l.payout)||void 0===w?void 0:w.paymentSuccess)||!1,payoutSignature:(null===(A=l.payout)||void 0===A?void 0:null===(E=A.transactions)||void 0===E?void 0:null===(x=E[0])||void 0===x?void 0:x.signature)||null};ea.setItem("payoutData",JSON.stringify(o)),console.log("\uD83C\uDFC6 Game completed, navigating to results page"),e.push("/result?matchId=".concat(j))}else if("waiting"===l.status){console.log("⏳ Waiting for other player to finish..."),y("waiting");let pollForCompletion=async()=>{try{let g=m.env.NEXT_PUBLIC_API_URL,h=await fetch("".concat(g,"/api/match/status/").concat(j,"?wallet=").concat(null==t?void 0:t.toString()));if(h.ok){let m=await h.json(),g=m.player1Result&&m.player2Result;m.isCompleted;let f="completed"===m.status||m.isCompleted;if(g&&f){var l,o,n,a,s,i,u,c,d,p;console.log("\uD83C\uDFC6 Game completed via polling:",{matchCompleted:f,bothPlayersHaveResults:g,status:m.status,isCompleted:m.isCompleted,hasPayout:!!m.payout});let h=(null==t?void 0:t.toString())===m.player1,v=h?m.player1Result:m.player2Result,y=h?m.player2Result:m.player1Result,w={won:m.winner===(null==t?void 0:t.toString()),isTie:"tie"===m.winner,winner:m.winner,numGuesses:(null==v?void 0:v.numGuesses)||r.numGuesses,entryFee:m.entryFee||M,timeElapsed:v?"".concat(Math.floor(v.totalTime/1e3),"s"):"".concat(Math.floor(r.totalTime/1e3),"s"),opponentTimeElapsed:y?"".concat(Math.floor(y.totalTime/1e3),"s"):"N/A",opponentGuesses:(null==y?void 0:y.numGuesses)||0,winnerAmount:(null===(l=m.payout)||void 0===l?void 0:l.winnerAmount)||0,feeAmount:(null===(o=m.payout)||void 0===o?void 0:o.feeAmount)||0,refundAmount:(null===(n=m.payout)||void 0===n?void 0:n.refundAmount)||0,isWinningTie:(null===(a=m.payout)||void 0===a?void 0:a.isWinningTie)||!1,feeWallet:(null===(s=m.payout)||void 0===s?void 0:s.feeWallet)||"",transactions:(null===(i=m.payout)||void 0===i?void 0:i.transactions)||[],automatedPayout:(null===(u=m.payout)||void 0===u?void 0:u.paymentSuccess)||!1,payoutSignature:(null===(p=m.payout)||void 0===p?void 0:null===(d=p.transactions)||void 0===d?void 0:null===(c=d[0])||void 0===c?void 0:c.signature)||null};ea.setItem("payoutData",JSON.stringify(w)),e.push("/result?matchId=".concat(j));return}}}catch(e){console.error("❌ Error polling for completion:",e)}setTimeout(pollForCompletion,2e3)};setTimeout(pollForCompletion,2e3)}}catch(e){console.error("❌ Failed to submit result:",e),N("Failed to submit result: ".concat(e.message)),y("error")}finally{el(!1)}},[j,t,p,$,M,e,et]);(0,n.useEffect)(()=>{eo.current=es},[es]);let ei=(0,n.useCallback)(async()=>{if(j&&t)try{H("reconnecting");let c=m.env.NEXT_PUBLIC_API_URL,d=new AbortController,p=setTimeout(()=>d.abort(),1e4),h=await fetch("".concat(c,"/api/match/game-state?matchId=").concat(j,"&wallet=").concat(t.toString()),{signal:d.signal});if(clearTimeout(p),h.ok){let d=await h.json();if(!d.success){console.error("❌ Game state fetch failed:",d.error),H("disconnected");return}if(H("connected"),g(d.playerGuesses||[]),J(d.remainingGuesses||7),Q(d.targetWord||""),0===$&&d.gameActive&&ee(Date.now()),!d.solved||(y("solved"),L(!1),console.log("⏰ Timer stopped - player solved the puzzle"),b||et||(console.log("\uD83C\uDFC6 Player solved, immediately submitting result"),es(!0,void 0,d.playerGuesses))),d.opponentSolved&&!I&&T(!0),d.gameCompleted){try{let e=await fetch("".concat(c,"/api/match/status/").concat(j));if(e.ok){let c=await e.json();if(c.payout&&c.isCompleted){var l,o,n,a,s,i,r,u;let e=(null==t?void 0:t.toString())===c.player1,d=e?c.player1Result:c.player2Result,m=e?c.player2Result:c.player1Result,p={won:c.winner===(null==t?void 0:t.toString())&&"tie"!==c.winner,isTie:"tie"===c.winner,winner:c.winner,numGuesses:(null==d?void 0:d.numGuesses)||0,entryFee:c.entryFee||M,timeElapsed:d?"".concat(Math.floor(d.totalTime/1e3),"s"):"N/A",opponentTimeElapsed:m?"".concat(Math.floor(m.totalTime/1e3),"s"):"N/A",opponentGuesses:(null==m?void 0:m.numGuesses)||0,winnerAmount:(null===(l=c.payout)||void 0===l?void 0:l.winnerAmount)||0,feeAmount:(null===(o=c.payout)||void 0===o?void 0:o.feeAmount)||0,feeWallet:(null===(n=c.payout)||void 0===n?void 0:n.feeWallet)||"",transactions:(null===(a=c.payout)||void 0===a?void 0:a.transactions)||[],automatedPayout:(null===(s=c.payout)||void 0===s?void 0:s.paymentSuccess)||!1,payoutSignature:(null===(u=c.payout)||void 0===u?void 0:null===(r=u.transactions)||void 0===r?void 0:null===(i=r[0])||void 0===i?void 0:i.signature)||null,proposalId:c.payoutProposalId||c.tieRefundProposalId,proposalStatus:c.proposalStatus};ea.setItem("payoutData",JSON.stringify(p))}}}catch(e){console.error("❌ Error fetching payout data:",e)}e.push("/result?matchId=".concat(j))}!d.solved||"solved"!==v||0!==d.remainingGuesses||b||et||(console.log("\uD83C\uDFC6 Player solved but ran out of guesses, submitting result"),es(!0,void 0,d.playerGuesses)),H("connected")}else console.error("❌ Failed to fetch game state:",h.status,h.statusText),H("disconnected")}catch(e){e instanceof Error&&"AbortError"===e.name?(console.warn("⚠️ Game state fetch timed out, will retry..."),H("reconnecting")):(console.error("❌ Error fetching game state:",e),H("disconnected"))}},[j,t,I,v,e,$,b,es,M]);(0,n.useEffect)(()=>{en.current=ei},[ei]),(0,n.useEffect)(()=>{if(!t&&"waiting"!==v&&"completed"!==v){console.log("\uD83D\uDD0C Wallet disconnected, redirecting to home"),e.push("/");return}let initializeGame=async()=>{try{var l;let o=e.query.matchId;if(o||(o=ea.getItem("matchId")||""),!o){console.error("❌ No match ID found in URL or localStorage"),e.push("/lobby");return}E(o);let n=m.env.NEXT_PUBLIC_API_URL,a=await fetch("".concat(n,"/api/match/status/").concat(o,"?wallet=").concat(null==t?void 0:t.toString()));if(!a.ok)throw Error("Failed to fetch match data");let s=await a.json();if("active"!==s.status){if(console.log("⚠️ Match is not active, status:",s.status),"cancelled"===s.status){console.log("⚠️ Match was cancelled, redirecting to lobby"),ea.removeItem("matchId"),ea.removeItem("word"),ea.removeItem("entryFee"),e.push("/lobby");return}if("payment_required"===s.status&&s.player1Paid&&s.player2Paid){console.log("⏳ Both players paid but game not yet active, waiting..."),setTimeout(()=>{e.reload()},2e3);return}let t=s.player1Result&&s.player2Result,l="completed"===s.status||s.isCompleted;if(t&&l){console.log("✅ Both players have results and match completed, redirecting to result page"),e.push("/result?matchId=".concat(o));return}console.log("⏳ Waiting for game completion:",{bothPlayersHaveResults:t,matchCompleted:l,status:s.status,player1Result:!!s.player1Result,player2Result:!!s.player2Result}),l&&!t?(console.log("⏳ Match completed but waiting for opponent results..."),y("waiting")):l||e.push("/matchmaking");return}if(s.isCompleted&&(console.log("⏳ Match marked as completed but waiting for opponent to finish..."),y("waiting")),s.player1!==(null==t?void 0:t.toString())&&s.player2!==(null==t?void 0:t.toString()))throw Error("You are not part of this match");let i=s.player1Result&&s.player2Result,r="completed"===s.status||s.isCompleted;if(i&&r){console.log("\uD83D\uDEA8 SAFETY REDIRECT: Match completed with both results, forcing redirect to results"),e.push("/result?matchId=".concat(o));return}(s.player1Result||s.player2Result)&&console.log("⏳ One player finished, waiting for opponent:",{player1Result:!!s.player1Result,player2Result:!!s.player2Result,matchCompleted:r}),_(s.feeWalletAddress||s.escrowAddress||""),U(s.entryFee||0),z(s);let u=(null==t?void 0:t.toString())===s.player1,c=u?s.player2:s.player1;if(c)try{let e=await fetch("".concat(n,"/api/user/username?wallet=").concat(c));if(e.ok){let t=await e.json();B(t.username||c.slice(0,8)+"...")}else B(c.slice(0,8)+"...")}catch(e){B(c.slice(0,8)+"...")}await (null===(l=en.current)||void 0===l?void 0:l.call(en)),G(Date.now()),C(!1)}catch(e){console.error("❌ Error initializing game:",e),N(e instanceof Error?e.message:"Failed to initialize game"),C(!1)}};initializeGame()},[t,e,M]),(0,n.useEffect)(()=>{let updateActivity=()=>{G(Date.now())};return window.addEventListener("keydown",updateActivity),window.addEventListener("click",updateActivity),window.addEventListener("touchstart",updateActivity),()=>{window.removeEventListener("keydown",updateActivity),window.removeEventListener("click",updateActivity),window.removeEventListener("touchstart",updateActivity)}},[]),(0,n.useEffect)(()=>{let handleVisibilityChange=()=>{if(document.hidden)console.log("\uD83D\uDCF1 Tab/window hidden - pausing game updates"),H("disconnected");else if(console.log("\uD83D\uDCF1 Tab/window visible - resuming game updates"),H("connected"),"playing"===v){var e;null===(e=en.current)||void 0===e||e.call(en)}},handleFocus=()=>{if(console.log("\uD83D\uDCF1 Page focused - refreshing game state"),"playing"===v){var e;null===(e=en.current)||void 0===e||e.call(en)}},handleBeforeUnload=e=>{if("playing"===v&&!w){let t="Game in progress! Are you sure you want to leave?";return e.preventDefault(),e.returnValue=t,t}},handleStorageError=e=>{null===e.key&&null===e.newValue&&(console.error("❌ localStorage quota exceeded or corrupted"),N("Storage error - please refresh the page"))};document.addEventListener("visibilitychange",handleVisibilityChange),window.addEventListener("focus",handleFocus),window.addEventListener("beforeunload",handleBeforeUnload),window.addEventListener("storage",handleStorageError);let handleOrientationChange=()=>{console.log("\uD83D\uDCF1 Orientation changed - refreshing layout"),setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100)};return window.addEventListener("orientationchange",handleOrientationChange),()=>{document.removeEventListener("visibilitychange",handleVisibilityChange),window.removeEventListener("focus",handleFocus),window.removeEventListener("beforeunload",handleBeforeUnload),window.removeEventListener("storage",handleStorageError),window.removeEventListener("orientationchange",handleOrientationChange)}},[v,w]),(0,n.useEffect)(()=>{if(!P||"playing"!==v){P&&"playing"!==v&&(console.log("⏰ Timer stopped - game state changed to:",v),L(!1));return}let e=setInterval(()=>{k(t=>{if(t<=0){if(clearInterval(e),L(!1),console.log("⏰ Timer reached zero, submitting timeout result"),et||b)console.log("⏰ Skipping timeout submission - already submitting or has result:",{isSubmittingResult:et,hasPlayerResult:!!b});else{var l;console.log("⏰ Calling handleGameEnd with timeout reason"),null===(l=eo.current)||void 0===l||l.call(eo,!1,"timeout")}return 0}return t-1})},1e3);return()=>clearInterval(e)},[P,v,et,b]),(0,n.useEffect)(()=>{"playing"!==v||P||(console.log("⏰ Starting 2-minute timer"),k(120),L(!0))},[v,P]),(0,n.useEffect)(()=>{if("playing"!==v&&"waiting"!==v||!j)return;let e=0,t=setInterval(async()=>{try{var t;await (null===(t=en.current)||void 0===t?void 0:t.call(en)),e=0}catch(t){e++,console.warn("⚠️ Poll attempt ".concat(e," failed, will retry...")),e>=3&&(console.error("❌ Max retries reached for game state polling"),e=0)}},3e4);return()=>clearInterval(t)},[j,v,t]),(0,n.useEffect)(()=>{if("playing"!==v&&"waiting"!==v||!j||!t)return;let l=!0,o=null,n=0,pollForMatchCompletion=async()=>{if(!l)return;try{let n=m.env.NEXT_PUBLIC_API_URL,f=await fetch("".concat(n,"/api/match/status/").concat(j,"?wallet=").concat(t.toString()));if(f.ok){let n=await f.json(),m=n.player1Result&&n.player2Result,v="completed"===n.status||n.isCompleted;if(m&&v){var a,s,i,r,u,c,d,p,g,h;let f="frontend-redirect-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));console.log("\uD83C\uDFC6 COMPREHENSIVE: Match completed detected via continuous polling:",{correlationId:f,matchId:j,matchCompleted:v,bothPlayersHaveResults:m,status:n.status,isCompleted:n.isCompleted,hasPayout:!!n.payout,hasPayoutProposalId:!!n.payoutProposalId,hasTieRefundProposalId:!!n.tieRefundProposalId,winner:n.winner,timestamp:new Date().toISOString(),action:"redirecting_to_results"}),l=!1,o&&(clearTimeout(o),o=null);let y=t.toString()===n.player1,w=y?n.player1Result:n.player2Result,x=y?n.player2Result:n.player1Result,b={won:n.winner===t.toString()&&"tie"!==n.winner,isTie:"tie"===n.winner,winner:n.winner,numGuesses:(null==w?void 0:w.numGuesses)||0,entryFee:n.entryFee||0,timeElapsed:w?"".concat(Math.floor(w.totalTime/1e3),"s"):"0s",opponentTimeElapsed:x?"".concat(Math.floor(x.totalTime/1e3),"s"):"N/A",opponentGuesses:(null==x?void 0:x.numGuesses)||0,winnerAmount:(null===(a=n.payout)||void 0===a?void 0:a.winnerAmount)||0,feeAmount:(null===(s=n.payout)||void 0===s?void 0:s.feeAmount)||0,refundAmount:(null===(i=n.payout)||void 0===i?void 0:i.refundAmount)||0,isWinningTie:(null===(r=n.payout)||void 0===r?void 0:r.isWinningTie)||!1,feeWallet:(null===(u=n.payout)||void 0===u?void 0:u.feeWallet)||"",transactions:(null===(c=n.payout)||void 0===c?void 0:c.transactions)||[],automatedPayout:(null===(d=n.payout)||void 0===d?void 0:d.paymentSuccess)||!1,payoutSignature:(null===(h=n.payout)||void 0===h?void 0:null===(g=h.transactions)||void 0===g?void 0:null===(p=g[0])||void 0===p?void 0:p.signature)||null,player1Result:n.player1Result,player2Result:n.player2Result},S=window.localStorage;S&&S.setItem("payoutData",JSON.stringify(b)),e.push("/result?matchId=".concat(j));return}}}catch(e){console.error("❌ Error polling for match completion:",e)}n++;let f=n<=30?1e3:2e3;l&&(o=setTimeout(pollForMatchCompletion,f))};return pollForMatchCompletion(),()=>{l=!1,o&&(clearTimeout(o),o=null)}},[j,v,t,e]),(0,n.useEffect)(()=>{let e=setInterval(()=>{let e=Date.now(),t=e-R;if(t>3e5&&"playing"===v&&(console.log("⏰ Player inactive for too long, auto-losing"),!et)){var l;null===(l=eo.current)||void 0===l||l.call(eo,!1,"timeout")}},3e4);return()=>clearInterval(e)},[R,v]),(0,n.useEffect)(()=>{I&&"playing"===v&&console.log("\uD83C\uDFC6 Opponent solved, but continuing to play until I finish")},[I,v]);let handleGuess=async e=>{if("playing"!==v||q||w)return;if(p.includes(e)){N("You already tried that word!"),setTimeout(()=>N(null),3e3);return}K(!0),G(Date.now());let submitGuessWithRetry=async function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var o;m.env.NEXT_PUBLIC_API_URL;let l=new AbortController,n=setTimeout(()=>l.abort(),15e3),a=await (0,d.EX)(j,(null==t?void 0:t.toString())||"",e);return clearTimeout(n),await new Promise(e=>setTimeout(e,500)),await (null===(o=en.current)||void 0===o?void 0:o.call(en)),a}catch(t){if(console.error("❌ Error submitting guess (attempt ".concat(l+1,"):"),t),l<2&&t instanceof Error&&("AbortError"===t.name||t.message.includes("Failed to fetch")))return await new Promise(e=>setTimeout(e,2e3)),submitGuessWithRetry(l+1);let e="Failed to submit guess";return t instanceof Error&&(e="AbortError"===t.name?"Request timed out - please try again":t.message),N(e),setTimeout(()=>N(null),5e3),null}finally{K(!1)}},l=await submitGuessWithRetry();if(l){if(l.solved){console.log("\uD83C\uDF89 Player solved the word! Submitting result immediately..."),y("solved"),x(!0),L(!1);let e=[...p,h];et||es(!0,"solved",e);return}if(0===l.remainingGuesses){y("solved"),L(!1);let e=[...p,h];w&&!et?es(!0,"solved",e):et||es(!1,"out_of_guesses",e)}}};return A?(0,o.jsx)("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:(0,o.jsx)("div",{className:"text-center",children:(0,o.jsxs)("div",{className:"flex items-center justify-center mb-4",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent mr-3"}),(0,o.jsx)("div",{className:"text-white text-xl font-semibold",children:"Loading game..."})]})})}):D?(0,o.jsx)("div",{className:"min-h-screen bg-primary flex items-center justify-center px-4",children:(0,o.jsxs)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-6 max-w-md w-full text-center",children:[(0,o.jsx)("div",{className:"text-red-400 text-xl font-bold mb-2",children:"❌ Error"}),(0,o.jsx)("p",{className:"text-white/80 mb-4",children:D}),(null==D?void 0:D.includes("already tried"))?(0,o.jsx)("button",{onClick:()=>N(null),className:"bg-accent hover:bg-yellow-400 text-primary px-6 py-2.5 rounded-lg font-bold transition-all duration-200 min-h-[44px] flex items-center justify-center mx-auto",children:"Return to Game"}):(0,o.jsx)("button",{onClick:()=>e.push("/lobby"),className:"bg-accent hover:bg-yellow-400 text-primary px-6 py-2.5 rounded-lg font-bold transition-all duration-200 min-h-[44px] flex items-center justify-center mx-auto",children:"Back to Lobby"})]})}):(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-primary px-2 relative",children:[(0,o.jsx)(c.F,{}),(0,o.jsxs)("div",{className:"flex flex-col items-center",children:[(0,o.jsx)("div",{className:"logo-shell mb-4 sm:mb-6",children:(0,o.jsx)(r(),{src:u.Z,alt:"Guess5 Logo",width:200,height:200,priority:!0})}),"playing"===v&&(0,o.jsxs)("div",{className:"bg-gradient-to-br from-white/5 via-white/10 to-white/5 backdrop-blur-sm rounded-2xl p-4 sm:p-6 mb-6 border border-white/20 shadow-xl w-full max-w-md",children:[(0,o.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-3",children:[(0,o.jsx)("span",{className:"text-2xl",children:"⏰"}),(0,o.jsxs)("span",{className:"text-accent text-xl sm:text-2xl font-bold",children:["Time Remaining: ","".concat(Math.floor(F/60).toString().padStart(2,"0"),":").concat((F%60).toString().padStart(2,"0"))]})]}),(0,o.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-3",children:["connected"===Z&&(0,o.jsx)("div",{className:"flex items-center gap-2 bg-green-500/10 border border-green-400/30 rounded-full px-3 py-1",children:(0,o.jsx)("span",{className:"text-green-400 text-sm font-semibold",children:"\uD83D\uDFE2 Connected"})}),"reconnecting"===Z&&(0,o.jsx)("div",{className:"flex items-center gap-2 bg-yellow-500/10 border border-yellow-400/30 rounded-full px-3 py-1",children:(0,o.jsx)("span",{className:"text-yellow-400 text-sm font-semibold animate-pulse",children:"\uD83D\uDFE1 Reconnecting..."})}),"disconnected"===Z&&(0,o.jsx)("div",{className:"flex items-center gap-2 bg-red-500/10 border border-red-400/30 rounded-full px-3 py-1",children:(0,o.jsx)("span",{className:"text-red-400 text-sm font-semibold",children:"\uD83D\uDD34 Disconnected"})})]})]}),D&&(0,o.jsx)("div",{className:"bg-gradient-to-r from-red-500/10 to-red-600/10 border-2 border-red-400/40 text-red-400 px-6 py-3 rounded-xl mb-4 text-center max-w-md w-full shadow-lg backdrop-blur-sm",children:(0,o.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,o.jsx)("span",{className:"text-xl",children:"❌"}),(0,o.jsx)("span",{className:"font-semibold",children:D})]})}),"waiting"===v&&(0,o.jsxs)("div",{className:"bg-gradient-to-br from-accent/10 via-yellow-500/10 to-accent/10 backdrop-blur-sm rounded-2xl p-6 sm:p-8 mb-6 border-2 border-accent/30 shadow-xl max-w-md w-full text-center",children:[(0,o.jsx)("div",{className:"text-3xl sm:text-4xl font-bold text-accent mb-3 animate-bounce",children:(null==b?void 0:b.won)?"\uD83C\uDF89 You solved it!":"\uD83C\uDFC1 You finished!"}),(0,o.jsxs)("div",{className:"text-white text-lg sm:text-xl mb-4 font-semibold",children:["Your Guesses: ",(null==b?void 0:b.numGuesses)||p.length,"/7",(null==b?void 0:b.numGuesses)===7&&" (All guesses used)"]}),(0,o.jsxs)("div",{className:"text-accent text-xl font-bold mb-4 flex items-center justify-center gap-2",children:[(0,o.jsx)("span",{className:"animate-spin",children:"⏳"}),(0,o.jsxs)("span",{children:["Waiting for ",O?"@".concat(O):"opponent"," to complete the puzzle..."]})]}),(0,o.jsx)("div",{className:"text-white/70 text-sm mb-3",children:"Results will be available once both players complete the game"}),(0,o.jsx)("div",{className:"text-white/50 text-xs",children:"Processing your result... Please wait"})]}),"playing"===v&&M>0&&(0,o.jsx)("div",{className:"mb-4 flex justify-center",children:(0,o.jsx)("div",{className:"bg-gradient-to-r from-accent/20 via-yellow-500/20 to-accent/20 backdrop-blur-sm rounded-xl px-6 py-3 border border-accent/30 shadow-lg",children:(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("span",{className:"text-accent text-2xl",children:"\uD83D\uDCB0"}),(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("span",{className:"text-white/70 text-xs font-medium",children:"Winner Takes"}),(0,o.jsxs)("span",{className:"text-accent text-lg font-bold",children:[(1.9*M).toFixed(4)," SOL"]})]})]})})}),"playing"===v&&(0,o.jsx)("div",{className:"mb-6",children:(0,o.jsx)(components_GameGrid,{guesses:p,currentGuess:h,setCurrentGuess:f,onGuess:handleGuess,remainingGuesses:Y,targetWord:X})}),"solved"===v&&(0,o.jsxs)("div",{className:"bg-gradient-to-br from-white/5 via-white/10 to-white/5 backdrop-blur-sm rounded-2xl p-6 mb-6 border border-white/20 shadow-xl max-w-md w-full text-center",children:[(0,o.jsx)("div",{className:"text-3xl font-bold text-accent mb-3",children:(null==b?void 0:b.won)?"\uD83C\uDF89 You solved it!":"❌ Game Over"}),(0,o.jsxs)("div",{className:"text-white text-xl font-semibold",children:["Guesses: ",(null==b?void 0:b.numGuesses)||0,"/7"]})]}),"completed"===v&&(0,o.jsxs)("div",{className:"bg-gradient-to-br from-accent/10 via-yellow-500/10 to-accent/10 backdrop-blur-sm rounded-2xl p-6 sm:p-8 mb-6 border-2 border-accent/30 shadow-xl max-w-md w-full text-center animate-fade-in",children:[(0,o.jsx)("div",{className:"text-3xl sm:text-4xl font-bold text-accent mb-4",children:(null==b?void 0:b.won)?"\uD83C\uDFC6 You Won!":"\uD83D\uDE14 You Lost"}),(0,o.jsxs)("div",{className:"flex items-center justify-center text-white/90 text-lg font-semibold",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-accent mr-3"}),"Processing payment..."]})]})]})]})}},1163:function(e,t,l){e.exports=l(9974)}},function(e){e.O(0,[675,960,774,888,179],function(){return e(e.s=134)}),_N_E=e.O()}]);