(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[418],{227:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/lobby",function(){return n(8481)}])},3874:function(e,t){"use strict";t.Z={src:"/_next/static/media/logo.174882b4.png",height:1024,width:1024,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAwElEQVR42mMQllESlVMRk1MRl1cVAyI5FVFZJWEZZQYRWWUOMTkeCXkGASkGfilGUTlOGWURGSUGXkkFdV19RXVtIzNzYwtLfX19dQVFPqAOIJg4sWvFivlr1y5ZunLR6lk9rY4MDOKaQHHu6Jionp62jo7mtvamrvaGUDc7BnYJBj5JBQkFVStbOwsbWysbW2sHR0ktA34JeZDlgtJKDDwgJUALGTjFBCXkgYIMQjJKQEpcQVVcHoSADCBXWEYJABn5I+WumxzZAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}},9702:function(e,t,n){"use strict";n.d(t,{K:function(){return usePendingClaims}});var a=n(7294),r=n(4306),l=n(1163),s=n(4155);let usePendingClaims=()=>{let{publicKey:e}=(0,r.O)(),t=(0,l.useRouter)(),[n,i]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null),checkPendingClaims=async()=>{if(!e){i(null);return}c(!0),u(null);try{let t=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/match/check-pending-claims/").concat(e.toString()));if(!t.ok)throw Error("Failed to check pending claims");let n=await t.json();i(n)}catch(e){u(e instanceof Error?e.message:"Unknown error"),console.error("Error checking pending claims:",e)}finally{c(!1)}},redirectToClaim=e=>{t.push("/result?matchId=".concat(e))},redirectToRefund=e=>{t.push("/result?matchId=".concat(e))};return(0,a.useEffect)(()=>{e?checkPendingClaims():i(null)},[e]),(0,a.useEffect)(()=>{if(!n||!e)return;let a=t.pathname;if("/result"!==a&&"/"!==a){if(n.hasPendingWinnings&&n.pendingWinnings.length>0){let e=n.pendingWinnings[0];console.log("\uD83C\uDFAF Player has pending winnings, redirecting to claim:",e.matchId),redirectToClaim(e.matchId);return}if(n.hasPendingRefunds&&n.refundCanBeExecuted&&n.pendingRefunds.length>0){let e=n.pendingRefunds[0];console.log("\uD83C\uDFAF Player has executable refund, redirecting to claim:",e.matchId),redirectToRefund(e.matchId);return}n.hasPendingRefunds&&!n.refundCanBeExecuted&&console.log("⏳ Player has pending refunds but cannot execute yet")}},[n,e,t.pathname]),{pendingClaims:n,loading:o,error:d,checkPendingClaims,redirectToClaim,redirectToRefund,hasBlockingClaims:(null==n?void 0:n.hasPendingWinnings)||(null==n?void 0:n.hasPendingRefunds)&&(null==n?void 0:n.refundCanBeExecuted)}}},8481:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Lobby}});var a=n(5893),r=n(1163),l=n(960),s=n(4306),i=n(1910),o=n(3182),c=n(7294),d=n(5675),u=n.n(d),m=n(3874),h=n(9702),x=n(4155),g=n(8764).Buffer;let p=[{id:"starter",usd:5,title:"Starter",badgeText:"\uD83C\uDFAE Warm-Up",badgeTheme:"green",headline:"Classic head-to-head with standard payouts.",incentive:"Perfect for dialling in strategies at full pot value.",cta:"Enter Starter Duel",bonusUsd:0},{id:"competitive",usd:20,title:"Competitive",badgeText:"⭐ Crowd Favorite",badgeTheme:"accent",headline:"Step up to the first tier with a platform bonus.",incentive:"We add $0.25 to every victory for more bragging rights.",cta:"Queue Competitive",isPopular:!0,bonusUsd:.25},{id:"highRoller",usd:50,title:"Veteran",badgeText:"\uD83C\uDFAF Bonus Stacked",badgeTheme:"blue",headline:"Bigger stakes with an even bigger bonus.",incentive:"Platform bonus: +$0.75 on every single win.",cta:"Go Veteran",isHighValue:!0,bonusUsd:.75},{id:"vip",usd:100,title:"VIP Elite",badgeText:"\uD83D\uDC8E VIP Showcase",badgeTheme:"purple",headline:"The most competitive tier with the biggest bonus we offer.",incentive:"Pocket an extra $2.00 every time you seal the match.",cta:"Claim a VIP Seat",isPremium:!0,bonusUsd:2}],f={accent:"bg-gradient-to-r from-accent to-yellow-400 text-black border-2 border-black/20",purple:"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-2 border-purple-300/50",blue:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white border-2 border-blue-300/50",green:"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-2 border-green-300/50"},fetchSolPrice=async()=>{console.log("\uD83D\uDD0D Fetching live SOL price from backend...");try{let e=x.env.NEXT_PUBLIC_API_URL||"https://guess5.onrender.com",t=await fetch("".concat(e,"/api/match/sol-price"));if(!t.ok)throw Error("Backend SOL price API returned ".concat(t.status,": ").concat(t.statusText));let n=await t.json();if(console.log("\uD83D\uDCCA Backend SOL price response:",n),n.price&&"number"==typeof n.price&&n.price>0)return console.log("✅ SOL price from backend:",n.price),n.price;if(n.fallback)return console.warn("⚠️ Backend returned fallback price:",n.fallback),n.fallback;throw Error("Invalid SOL price data from backend")}catch(e){return console.error("❌ Backend SOL price fetch failed:",e),console.warn("⚠️ Using client-side fallback price: $180"),180}};function Lobby(){let e=(0,r.useRouter)(),{publicKey:t,signTransaction:d}=(0,s.O)(),{pendingClaims:b,hasBlockingClaims:w,checkPendingClaims:v}=(0,h.K)(),[y,j]=(0,c.useState)(!1),[N,k]=(0,c.useState)(!1),[S,D]=(0,c.useState)(null),[C,F]=(0,c.useState)(null),[P,I]=(0,c.useState)(null),[A,E]=(0,c.useState)(null),R=(0,c.useMemo)(()=>p.map(e=>{let t=S?+(e.usd/S).toFixed(4):null,n=2*e.usd*.95,a=e.bonusUsd,r=n+a,l=S&&a>0?+(a/S).toFixed(4):null,s=S&&r>0?+(r/S).toFixed(4):null,i=(r-e.usd)/e.usd*100;return{...e,solAmount:t,baseWinningsUsd:n,totalWinUsd:r,bonusUsd:a,bonusSol:l,totalWinSol:s,roi:i,solPriceUsed:S||null}}),[S]),L=null!==C&&S?C*S:null,O=R[R.length-1],T=!!((null==O?void 0:O.solAmount)&&null!==C&&C>=O.solAmount),B=null!==C?R.find(e=>e.solAmount&&C<e.solAmount):null,U=B&&null!==L?Math.max(0,B.usd-L):null,getTierHighlightTextClass=e=>e?e.isPremium?"text-purple-300":e.isHighValue?"text-blue-300":e.isPopular?"text-accent":"text-white":"text-white";(0,c.useEffect)(()=>{let getPrice=async()=>{try{let e=await fetchSolPrice();console.log("\uD83D\uDCB0 Setting SOL price:",e),D(e),e&&e>0||console.warn("⚠️ Invalid SOL price received:",e)}catch(e){console.error("❌ Error in getPrice:",e)}};console.log("\uD83D\uDE80 Initializing SOL price fetching..."),getPrice();let e=setInterval(()=>{console.log("\uD83D\uDD04 Refreshing SOL price..."),getPrice()},3e4);return()=>{console.log("\uD83E\uDDF9 Cleaning up SOL price interval"),clearInterval(e)}},[]),(0,c.useEffect)(()=>{let e=!0,n=null,fetchBalance=async()=>{if(!t){e&&F(null);return}try{let n=x.env.NEXT_PUBLIC_SOLANA_NETWORK||"https://api.devnet.solana.com",a=new o.Connection(n,"confirmed"),r=await a.getBalance(t);e&&F(r/o.LAMPORTS_PER_SOL)}catch(t){console.error("Failed to check wallet balance:",t),e&&F(null)}};return fetchBalance(),t&&(n=setInterval(fetchBalance,15e3)),()=>{e=!1,n&&clearInterval(n)}},[t]),(0,c.useEffect)(()=>{localStorage.removeItem("matchId"),localStorage.removeItem("word"),localStorage.removeItem("entryFee"),t?(0,i.Ms)(t.toString()).then(e=>E(e.username||null)).catch(e=>console.error("Failed to load username:",e)):E(null);let checkForActiveMatch=async()=>{if(t)try{let{config:a}=await Promise.resolve().then(n.bind(n,4026)),r=await fetch("".concat(a.API_URL,"/api/match/check-player-match/").concat(t.toString()));if(r.ok){let t=await r.json();if(t.matched&&"active"===t.status){console.log("\uD83C\uDFAE Found active match, redirecting to game:",t.matchId),localStorage.setItem("matchId",t.matchId),t.word&&localStorage.setItem("word",t.word),t.entryFee&&localStorage.setItem("entryFee",t.entryFee.toString()),e.push("/game?matchId=".concat(t.matchId));return}}}catch(e){console.error("❌ Error checking for active match:",e)}};checkForActiveMatch()},[t,e]);let handleSelect=async(n,a)=>{if(console.log("\uD83C\uDFAE handleSelect called with:",{usdAmount:n,solAmount:a}),!t){alert("Please connect your wallet first!");return}if(w){if(console.log("\uD83D\uDEAB Player has pending claims, preventing new matchmaking"),(null==b?void 0:b.hasPendingWinnings)&&b.pendingWinnings.length>0){let t=b.pendingWinnings[0];alert("You have unclaimed winnings from a previous match! Please claim your ".concat(t.entryFee.toFixed(4)," SOL winnings before starting a new game.")),e.push("/result?matchId=".concat(t.matchId));return}if((null==b?void 0:b.hasPendingRefunds)&&b.refundCanBeExecuted&&b.pendingRefunds.length>0){var r;let t=b.pendingRefunds[0];alert("You have an unclaimed refund from a previous match! Please claim your ".concat((null===(r=t.refundAmount)||void 0===r?void 0:r.toFixed(4))||t.entryFee.toFixed(4)," SOL refund before starting a new game.")),e.push("/result?matchId=".concat(t.matchId));return}}if((null==b?void 0:b.hasPendingRefunds)&&!b.refundCanBeExecuted&&b.pendingRefunds.length>0){let e=b.pendingRefunds.length;alert("You have ".concat(e," pending refund(s) that need your signature. Please sign for all refunds before starting a new match."));return}if(N){console.log("⏳ Already matchmaking, ignoring click");return}if(!A){alert("Please set a username before entering the queue. You can set it in the top right corner.");return}if(null!==C&&C<a){alert("Insufficient balance! You have ".concat(C.toFixed(4)," SOL but need ").concat(a.toFixed(4)," SOL for this game."));return}k(!0);try{console.log("\uD83D\uDCBE Storing entry fee in localStorage:",a),localStorage.setItem("entryFeeSOL",a.toString()),console.log("\uD83D\uDCE1 Calling requestMatch with:",{wallet:t.toString(),entryFee:a});let n=await (0,i.B2)(t.toString(),a);console.log("\uD83D\uDCE1 requestMatch result:",n),"matched"===n.status?(console.log("✅ Match found, redirecting to matchmaking with matchId"),e.push("/matchmaking?matchId=".concat(n.matchId,"&entryFee=").concat(a))):"waiting"===n.status?(console.log("⏳ Waiting for opponent, redirecting to matchmaking"),e.push("/matchmaking?entryFee=".concat(a))):"vault_pending"===n.status?(console.log("⏳ Vault pending detected; redirecting to matchmaking to continue polling"),e.push("/matchmaking?matchId=".concat(n.matchId,"&entryFee=").concat(a))):(console.log("❌ Unknown result status:",n.status),alert("Failed to start matchmaking. Please try again."),k(!1))}catch(t){console.error("❌ Matchmaking error:",t);let e="Failed to start matchmaking. Please try again.";t instanceof Error&&(t.message.includes("ReCaptcha")?e="ReCaptcha verification failed. Please refresh the page and try again.":t.message.includes("network")||t.message.includes("connection")?e="Network error. Please check your connection and try again.":t.message.includes("timeout")&&(e="Request timed out. Please try again.")),alert(e),k(!1)}},{disconnect:_}=(0,s.O)(),[W,M]=(0,c.useState)(!1),[V,Y]=(0,c.useState)(""),[$,J]=(0,c.useState)(null),[G,X]=(0,c.useState)(!1),[z,H]=(0,c.useState)(!1),handleUsernameChange=async e=>{Y(e),J(null);let t=/^[a-zA-Z0-9_]{3,20}$/;if(e&&!t.test(e)){J("3-20 chars, letters/numbers/underscores only");return}if(e&&t.test(e)){X(!0);try{let t=await (0,i.EJ)(e);t.available||J("Username taken")}catch(e){console.error("Failed to check username:",e)}finally{X(!1)}}},handleSaveUsername=async()=>{if(t&&V.trim()){if(!/^[a-zA-Z0-9_]{3,20}$/.test(V)){J("Invalid format");return}H(!0),J(null);try{await (0,i.b6)(t.toString(),V.trim()),E(V.trim().toLowerCase()),M(!1),Y("")}catch(e){J(e.message||"Failed to save username")}finally{H(!1)}}};return(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-primary px-4 sm:px-6 py-8 relative",children:(0,a.jsxs)("div",{className:"flex flex-col items-center w-full max-w-6xl",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6 sm:mb-8",children:[(0,a.jsx)("div",{className:"logo-shell mb-4 sm:mb-6",children:(0,a.jsx)(u(),{src:m.Z,alt:"Guess5 Logo",width:180,height:180,priority:!0})}),(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"mb-4 bg-white/10 hover:bg-white/20 text-white px-5 py-2.5 rounded-lg transition-all duration-200 text-sm border border-white/20 hover:border-white/30 backdrop-blur-sm",children:"← Back to Home"})]}),!t&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(l.w,{})}),t?(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-secondary/20 to-secondary/10 rounded-2xl p-6 sm:p-8 border border-white/10 backdrop-blur-sm shadow-2xl",children:[(0,a.jsxs)("div",{className:"text-center mb-10",children:[(0,a.jsxs)("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-white mb-4 tracking-tight",children:["Choose Your ",(0,a.jsx)("span",{className:"bg-gradient-to-r from-accent via-yellow-400 to-accent bg-clip-text text-transparent",children:"Level of Competition"})]}),(0,a.jsx)("p",{className:"text-white/70 text-base sm:text-lg mb-8 font-medium",children:"Choose a tier, lock your entry, and we will seat you against a worthy opponent."}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-8 flex-wrap",children:[S&&(0,a.jsxs)("div",{className:"flex items-center gap-2.5 bg-gradient-to-r from-blue-500/10 to-blue-600/10 rounded-xl px-5 py-3 border border-blue-400/20 backdrop-blur-sm",children:[(0,a.jsx)("span",{className:"text-white/80 text-sm font-medium",children:"SOL Price:"}),(0,a.jsxs)("span",{className:"text-blue-300 font-bold text-lg",children:["$",S.toFixed(2)]}),(0,a.jsx)("button",{onClick:async()=>{console.log("\uD83D\uDD04 Manual SOL price refresh requested");let e=await fetchSolPrice();D(e)},className:"text-blue-400 hover:text-blue-300 text-sm transition-colors ml-1",title:"Refresh SOL price",children:"\uD83D\uDD04"})]}),null!==C&&(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-gradient-to-r from-green-500/10 to-green-600/10 rounded-xl px-5 py-3 border border-green-400/20 backdrop-blur-sm",children:[(0,a.jsx)("span",{className:"text-white/80 text-sm font-medium",children:"Your Balance:"}),(0,a.jsxs)("span",{className:"text-green-300 font-bold text-lg",children:[C.toFixed(4)," SOL"]}),null!==L&&(0,a.jsxs)("span",{className:"text-green-200 text-sm font-semibold",children:["($",L.toFixed(2)," USD)"]})]}),t&&(0,a.jsx)("div",{className:"relative flex items-center gap-2.5 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl px-5 py-3 border border-purple-400/20 backdrop-blur-sm",children:W?(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-white/80 text-sm font-medium",children:"@"}),(0,a.jsx)("input",{type:"text",value:V,onChange:e=>handleUsernameChange(e.target.value),placeholder:"username",className:"px-3 py-1.5 rounded-lg bg-white/10 border border-purple-400/50 text-white placeholder-white/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all text-sm font-medium w-32",maxLength:20,disabled:z}),G&&(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-purple-400/30 border-t-purple-300"}),(0,a.jsx)("button",{onClick:handleSaveUsername,disabled:z||!!$||!V.trim(),className:"px-3 py-1.5 bg-accent hover:bg-yellow-300 text-primary font-bold rounded-lg transition-all text-xs disabled:opacity-50",children:z?"...":"Save"}),(0,a.jsx)("button",{onClick:()=>{M(!1),Y(""),J(null)},className:"px-3 py-1.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all text-xs",children:"Cancel"})]}),$&&(0,a.jsx)("div",{className:"px-3 py-1.5 text-red-300 text-xs font-medium bg-red-500/15 border border-red-500/40 rounded-lg",children:$})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-white/80 text-sm font-medium",children:"Username:"}),A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"text-purple-300 font-bold text-lg",children:["@",A]}),(0,a.jsx)("button",{onClick:()=>{M(!0),Y(A),J(null)},className:"text-purple-400 hover:text-purple-300 text-xs transition-colors ml-1",title:"Edit username",children:"✏️"})]}):(0,a.jsx)("button",{onClick:()=>{M(!0),Y(""),J(null)},className:"text-purple-300 hover:text-purple-200 text-sm font-medium transition-colors",children:"Set Username"})]})}),t&&(0,a.jsxs)("button",{onClick:()=>_(),className:"flex items-center gap-2 bg-gradient-to-r from-red-500/10 to-red-600/10 rounded-xl px-5 py-3 border border-red-400/20 backdrop-blur-sm hover:from-red-500/20 hover:to-red-600/20 transition-all text-sm font-medium text-red-300 hover:text-red-200",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Disconnect"]}),!S&&(0,a.jsx)("div",{className:"text-yellow-400 text-sm bg-yellow-500/10 rounded-xl px-5 py-3 border border-yellow-400/20",children:"\uD83D\uDD04 Loading SOL price..."})]}),null!==L&&(0,a.jsx)("div",{className:"text-white/70 text-sm text-center max-w-3xl mx-auto mb-6",children:T&&O?(0,a.jsxs)(a.Fragment,{children:["You already cover"," ",(0,a.jsx)("span",{className:"".concat(getTierHighlightTextClass(O)," font-semibold"),children:O.title}),". Jump in now and play for",(0,a.jsxs)("span",{className:"text-green-300 font-semibold",children:[" ","$",O.totalWinUsd.toFixed(2)]})," ","including our platform bonus."]}):B&&null!==U?(0,a.jsxs)(a.Fragment,{children:["Deposit"," ",(0,a.jsxs)("span",{className:"text-accent font-semibold",children:["$",U.toFixed(2)]})," ","more to unlock"," ",(0,a.jsx)("span",{className:"".concat(getTierHighlightTextClass(B)," font-semibold"),children:B.title})," ","and compete for"," ",(0,a.jsxs)("span",{className:"text-green-300 font-semibold",children:["$",B.totalWinUsd.toFixed(2)]}),"with the built-in platform bonus."]}):(0,a.jsx)(a.Fragment,{children:"Top up your wallet to unlock bigger pots and larger platform bonuses."})})]}),w&&(0,a.jsx)("div",{className:"bg-yellow-500/20 border-2 border-yellow-500/50 rounded-xl p-5 mb-6 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⚠️"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-yellow-400 font-bold text-lg mb-2",children:"Unclaimed Funds Detected"}),(0,a.jsxs)("div",{className:"text-white/90 text-sm space-y-1 mb-3",children:[(null==b?void 0:b.hasPendingWinnings)&&b.pendingWinnings.length>0&&(0,a.jsxs)("div",{children:["• ",b.pendingWinnings.length," unclaimed winning(s)"]}),(null==b?void 0:b.hasPendingRefunds)&&b.refundCanBeExecuted&&b.pendingRefunds.length>0&&(0,a.jsxs)("div",{children:["• ",b.pendingRefunds.length," unclaimed refund(s)"]})]}),(0,a.jsx)("div",{className:"text-white/70 text-xs",children:"Please claim your funds before starting a new game."})]})]})}),(null==b?void 0:b.hasPendingRefunds)&&!b.refundCanBeExecuted&&b.pendingRefunds.length>0&&(0,a.jsxs)("div",{className:"bg-orange-500/20 border-2 border-orange-500/50 rounded-xl p-5 mb-6 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,a.jsx)("div",{className:"text-orange-400 text-2xl",children:"\uD83D\uDCDD"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"text-orange-400 font-bold text-lg mb-1",children:["Sign Pending Refunds (",b.pendingRefunds.length," total)"]}),(0,a.jsx)("div",{className:"text-white/80 text-sm",children:"You must sign for all pending refunds before starting a new match."})]})]}),(()=>{var e;let r=[...b.pendingRefunds].sort((e,t)=>{let n=e.proposalCreatedAt?new Date(e.proposalCreatedAt).getTime():0,a=t.proposalCreatedAt?new Date(t.proposalCreatedAt).getTime():0;return n-a}),l=r[0];return(0,a.jsx)("div",{className:"bg-black/40 rounded-lg p-4 border border-white/10",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"text-white/90 text-sm font-medium mb-1",children:["Match: ",l.matchId.substring(0,8),"..."]}),(0,a.jsxs)("div",{className:"text-accent text-base font-bold",children:[(null===(e=l.refundAmount)||void 0===e?void 0:e.toFixed(4))||l.entryFee.toFixed(4)," SOL"]}),b.pendingRefunds.length>1&&(0,a.jsxs)("div",{className:"text-white/60 text-xs mt-2",children:["+ ",b.pendingRefunds.length-1," more refund(s) to sign"]})]}),(0,a.jsx)("button",{onClick:async()=>{if(t&&d&&P!==l.matchId){I(l.matchId);try{let e=x.env.NEXT_PUBLIC_API_URL||"";console.log("\uD83E\uDDFE Attempting to sign pending refund",{matchId:l.matchId,wallet:t.toString(),refundAmount:l.refundAmount||l.entryFee,proposalId:l.proposalId});let a=await fetch("".concat(e,"/api/match/get-proposal-approval-transaction?matchId=").concat(l.matchId,"&wallet=").concat(t.toString()));if(!a.ok){let e=await a.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||e.details||"Failed to get approval transaction")}let r=await a.json();if(!r.transaction)throw Error("No transaction data received from server");let{VersionedTransaction:s}=await Promise.resolve().then(n.bind(n,3182)),i=g.from(r.transaction,"base64"),o=s.deserialize(i),c=await d(o),u=c.serialize(),m=g.from(u).toString("base64");console.log("\uD83D\uDCE4 Submitting signed refund proposal to backend",{matchId:l.matchId,wallet:t.toString(),serializedLength:u.length});let h=await fetch("".concat(e,"/api/match/sign-proposal"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchId:l.matchId,wallet:t.toString(),signedTransaction:m})});if(!h.ok){let e=await h.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||e.details||"Failed to sign proposal")}let p=await h.json().catch(()=>({}));console.log("✅ Refund proposal signed successfully",{matchId:l.matchId,wallet:t.toString(),response:p}),await v(),alert("✅ Refund proposal signed! ".concat(b.pendingRefunds.length-1>0?"You have ".concat(b.pendingRefunds.length-1," more refund(s) to sign."):"All refunds signed!"))}catch(e){console.error("❌ Error signing refund proposal:",e),alert(e instanceof Error?e.message:"Failed to sign refund proposal")}finally{I(null)}}},disabled:P===l.matchId||!d,className:"bg-accent hover:bg-yellow-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-black font-bold py-3 px-8 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 min-w-[160px] flex items-center justify-center",children:P===l.matchId?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-black mr-2"}),"Signing..."]}):"Sign Refund"})]})})})()]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8 max-w-7xl mx-auto items-stretch",children:R.map(e=>{let{id:t,usd:n,solAmount:r,baseWinningsUsd:l,totalWinUsd:s,totalWinSol:i,bonusUsd:o,bonusSol:c,roi:d,title:u,headline:m,incentive:h,badgeText:x,badgeTheme:g,cta:p,isPopular:v=!1,isHighValue:y=!1,isPremium:j=!1}=e,k="number"==typeof r&&r>0,S=null!==C&&k&&null!==r&&C>=r,D=(null==b?void 0:b.hasPendingRefunds)&&!b.refundCanBeExecuted&&b.pendingRefunds.length>0,F=!k||!S||N||w||D||!A,P=x&&g&&f[g]?f[g]:"bg-white/20 text-white border border-white/20";return(0,a.jsx)("button",{onClick:()=>{if(!k||null==r){alert("Fetching live SOL price. Please try again in a moment.");return}handleSelect(n,r)},disabled:F,className:"relative group w-full h-full transition-all duration-300 ".concat(N?"opacity-60":""),children:(0,a.jsxs)("div",{className:"relative h-full bg-gradient-to-br ".concat(F?"from-gray-800/40 to-gray-900/40 cursor-not-allowed border-gray-700/30":v?"from-accent/25 via-yellow-500/20 to-accent/25 border-2 border-accent/60 shadow-2xl shadow-accent/20":j?"from-purple-600/20 via-purple-500/15 to-purple-600/20 border-2 border-purple-400/40 shadow-xl":y?"from-blue-600/20 via-blue-500/15 to-blue-600/20 border-2 border-blue-400/40 shadow-xl":"from-white/8 via-white/5 to-white/8 border border-white/20 shadow-lg"," rounded-3xl p-6 sm:p-8 backdrop-blur-sm transition-all duration-300 hover:shadow-2xl ").concat(F||N?"":"hover:scale-105 hover:border-accent/80"),children:[x&&!F&&(0,a.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 ".concat(P," text-xs font-extrabold px-4 py-1 rounded-full shadow-xl uppercase tracking-wide z-20"),children:x}),(0,a.jsxs)("div",{className:"flex flex-col items-center text-center h-full pt-2",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center w-full flex-1",children:[(0,a.jsx)("div",{className:"uppercase tracking-[0.35em] text-xs text-white/50 mb-3",children:u}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("div",{className:"text-4xl sm:text-5xl lg:text-6xl font-black mb-1 ".concat(F?"text-gray-500":v?"text-accent":j?"text-purple-300":y?"text-blue-300":"text-white"),children:["$",n]}),(0,a.jsx)("div",{className:"text-white/60 text-xs sm:text-sm font-medium",children:k?"≈ ".concat(r," SOL"):"Loading price..."})]}),(0,a.jsx)("div",{className:"w-12 sm:w-16 h-0.5 mb-4 sm:mb-6 ".concat(v?"bg-accent/50":j?"bg-purple-400/50":y?"bg-blue-400/50":"bg-white/20")}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"space-y-2 mb-3",children:[(0,a.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-center",children:[(0,a.jsx)("div",{className:"text-white/70 text-[11px] uppercase tracking-[0.25em] mb-1 font-semibold",children:"Core Pot"}),(0,a.jsxs)("div",{className:"text-2xl sm:text-3xl font-black text-white",children:["$",l.toFixed(2)]}),(0,a.jsxs)("div",{className:"text-white/60 text-xs font-medium mt-1",children:["95% of $",(2*n).toFixed(2)," prize pool"]})]}),(0,a.jsxs)("div",{className:"bg-accent/10 border border-accent/25 rounded-xl px-4 py-2.5 text-center",children:[(0,a.jsx)("div",{className:"text-accent text-[11px] uppercase tracking-[0.25em] mb-1 font-semibold",children:"Platform Bonus"}),(0,a.jsxs)("div",{className:"text-accent text-sm font-semibold",children:["+$",o.toFixed(2)," ",c?"(≈ ".concat(c," SOL)"):""]})]})]}),(0,a.jsx)("div",{className:"text-white/70 text-xs uppercase tracking-wider mb-1.5 font-semibold",children:"Total Payout"}),(0,a.jsxs)("div",{className:"text-2xl sm:text-3xl font-black mb-1 ".concat(F?"text-gray-500":"text-green-400"),children:["$",s.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"text-white font-semibold text-sm mb-3",children:["Effective ROI: +",d.toFixed(2),"%"]}),(0,a.jsx)("div",{className:"text-white/70 text-sm font-medium mb-4",children:m})]}),(0,a.jsxs)("div",{className:"w-full mt-auto pt-5 sm:pt-6",children:[!A&&(0,a.jsx)("div",{className:"text-xs text-yellow-400 font-semibold bg-yellow-500/10 px-3 py-1.5 rounded-lg border border-yellow-500/20 mb-2",children:"⚠ Username Required"}),!S&&null!==C&&(0,a.jsx)("div",{className:"text-xs text-red-400 font-semibold bg-red-500/10 px-3 py-1.5 rounded-lg border border-red-500/20",children:"⚠ Insufficient Balance"}),w&&(0,a.jsx)("div",{className:"text-xs text-yellow-400 font-semibold bg-yellow-500/10 px-3 py-1.5 rounded-lg border border-yellow-500/20",children:"⚠ Claim Funds First"}),D&&(0,a.jsx)("div",{className:"text-xs text-orange-400 font-semibold bg-orange-500/10 px-3 py-1.5 rounded-lg border border-orange-500/20",children:"⚠ Sign Refunds First"}),!F&&!w&&!D&&null!==C&&S&&(0,a.jsx)("div",{className:"text-xs sm:text-sm font-bold py-2 sm:py-2.5 px-4 sm:px-6 rounded-xl transition-all ".concat(v?"bg-accent text-black hover:bg-yellow-400":j?"bg-purple-500 text-white hover:bg-purple-400":y?"bg-blue-500 text-white hover:bg-blue-400":"bg-white/10 text-white hover:bg-white/20"),children:p||"Select This Tier"})]})]})]})},t)})}),N&&(0,a.jsxs)("div",{className:"text-center mt-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"inline-flex items-center gap-3 bg-accent/20 rounded-full px-6 py-4 border border-accent/30",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-accent"}),(0,a.jsx)("div",{className:"text-accent text-lg font-semibold",children:"Finding Opponent..."})]}),(0,a.jsx)("div",{className:"text-white/60 text-sm mt-3",children:"Redirecting to matchmaking..."})]}),(0,a.jsxs)("div",{className:"mt-8 pt-6 border-t border-white/10",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 text-xs text-white/60",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-green-400",children:"✓"}),(0,a.jsx)("span",{children:"Non-Custodial"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-green-400",children:"✓"}),(0,a.jsx)("span",{children:"2-of-3 Multisig"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-green-400",children:"✓"}),(0,a.jsx)("span",{children:"Squads Protocol"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-green-400",children:"✓"}),(0,a.jsx)("span",{children:"Winner Gets 95%"})]})]}),(0,a.jsx)("div",{className:"text-center text-white/40 text-[11px] mt-4",children:"* Platform bonuses hit your wallet automatically on eligible wins. Promotional amounts rotate weekly."})]})]})}):(0,a.jsxs)("div",{className:"bg-secondary bg-opacity-10 rounded-2xl p-8 max-w-md w-full text-center border border-white/10 backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"text-white text-lg font-medium mb-2",children:"Connect Your Wallet"}),(0,a.jsx)("div",{className:"text-white/70 text-sm",children:"Please connect your Phantom wallet to start playing"})]})]})})}},1163:function(e,t,n){e.exports=n(9974)}},function(e){e.O(0,[675,960,774,888,179],function(){return e(e.s=227)}),_N_E=e.O()}]);