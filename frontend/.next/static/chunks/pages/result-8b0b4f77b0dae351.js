(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{7170:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/result",function(){return s(8084)}])},3874:function(e,t){"use strict";t.Z={src:"/_next/static/media/logo.174882b4.png",height:1024,width:1024,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAwElEQVR42mMQllESlVMRk1MRl1cVAyI5FVFZJWEZZQYRWWUOMTkeCXkGASkGfilGUTlOGWURGSUGXkkFdV19RXVtIzNzYwtLfX19dQVFPqAOIJg4sWvFivlr1y5ZunLR6lk9rY4MDOKaQHHu6Jionp62jo7mtvamrvaGUDc7BnYJBj5JBQkFVStbOwsbWysbW2sHR0ktA34JeZDlgtJKDDwgJUALGTjFBCXkgYIMQjJKQEpcQVVcHoSADCBXWEYJABn5I+WumxzZAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}},8084:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return result}});var n=s(5893),o=s(7294),l=s(1163),a=s(4306),r=s(3182),i=s(5675),d=s.n(i),u=s(3874),c=s(960),p=s(4155);let SquadsClient=class SquadsClient{async signProposal(e,t,s){try{return console.log("\uD83D\uDD10 Signing Squads proposal",{vaultAddress:e,proposalId:t,signer:s.toString()}),new r.PublicKey(e),BigInt(t),{success:!0}}catch(e){return console.error("❌ Error signing proposal:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}async checkProposalStatus(e,t){try{return new r.PublicKey(e),BigInt(t),{executed:!1,signers:[],needsSignatures:2}}catch(e){return console.error("❌ Failed to check proposal status",e),{executed:!1,signers:[],needsSignatures:2}}}async getMultisigDetails(e){try{return new r.PublicKey(e),{address:e,members:[],threshold:2,configAuthority:""}}catch(e){return console.error("❌ Failed to get multisig details",e),null}}async isMultisigMember(e,t){try{let s=await this.getMultisigDetails(e);if(!s)return!1;return s.members.includes(t)}catch(e){return console.error("❌ Failed to check multisig membership",e),!1}}async hasSignedProposal(e,t,s){try{let n=await this.checkProposalStatus(e,t);return n.signers.some(e=>e.toString()===s)}catch(e){return console.error("❌ Failed to check if wallet has signed",e),!1}}constructor(){this.connection=new r.Connection(p.env.NEXT_PUBLIC_SOLANA_NETWORK||"https://api.devnet.solana.com","confirmed")}};new SquadsClient;var m=s(4026),x=s(4155),g=s(8764).Buffer;let normalizeProposalSigners=e=>{let normalize=e=>{if(!e)return[];if(Array.isArray(e))return e.flatMap(e=>normalize(e)).filter(e=>"string"==typeof e&&e.length>0);if("string"==typeof e){let t=e.trim();if(!t)return[];if(t.startsWith("[")||t.startsWith("{"))try{return normalize(JSON.parse(t))}catch(e){}return t.includes(",")?t.split(",").map(e=>e.trim()).filter(e=>e.length>0):[t]}return"object"==typeof e?normalize(Object.values(e)):[]},t=normalize(e);return Array.from(new Set(t))},h={starter:0,competitive:.25,highRoller:.75,vip:2},b={starter:"Starter",competitive:"Competitive",highRoller:"High Roller",vip:"VIP Elite"},getBonusTierLabel=e=>e&&b[e]||"Premium";var result=()=>{var e,t,i,p,b,f,v,y,S,w,N,D,j,A,E,I,P,T,F,R;let C=(0,l.useRouter)(),{publicKey:k,signTransaction:O}=(0,a.O)(),[L,U]=(0,o.useState)(null),[_,W]=(0,o.useState)(!0),[B,M]=(0,o.useState)(null),[X,G]=(0,o.useState)(!1),[Y]=(0,o.useState)(()=>new SquadsClient),[V,q]=(0,o.useState)(!1),[z,K]=(0,o.useState)(null),[H,J]=(0,o.useState)(null),[$,Q]=(0,o.useState)(null),Z=(0,o.useRef)(null),ee=(0,o.useRef)(null),stopRefreshLoops=()=>{Z.current&&(clearInterval(Z.current),Z.current=null),ee.current&&(clearTimeout(ee.current),ee.current=null)},shouldContinuePolling=e=>{if((null==e?void 0:e.proposalStatus)==="EXECUTED"||(null==e?void 0:e.proposalExecutedAt))return console.log("\uD83D\uDED1 Stopping polling: Proposal is executed",{proposalStatus:null==e?void 0:e.proposalStatus,proposalExecutedAt:null==e?void 0:e.proposalExecutedAt}),!1;if(!(null==e?void 0:e.proposalId))return console.log("\uD83D\uDD04 Continue polling: No proposal ID yet",{proposalId:null==e?void 0:e.proposalId,hasPlayerResults:!!((null==e?void 0:e.player1Result)&&(null==e?void 0:e.player2Result))}),!0;if(!e)return!1;let t=(e.proposalStatus||"").toString().toUpperCase(),s=Number.isFinite(e.needsSignatures)?Number(e.needsSignatures):0;if(e.player1Result&&e.player2Result){if(e.proposalTransactionId||"EXECUTED"===t)return!1;if(e.proposalId){if(s>0)return!0;"EXECUTED"!==t&&e.proposalTransactionId}return!0}return!e.proposalId||!e.proposalTransactionId&&"EXECUTED"!==t&&(s>0||"ACTIVE"===t||"PENDING"===t)},et=(0,o.useMemo)(()=>normalizeProposalSigners(null==L?void 0:L.proposalSigners),[null==L?void 0:L.proposalSigners]),es=(0,o.useMemo)(()=>{var e,t;let s=null===(t=m.Z.FEE_WALLET_ADDRESS)||void 0===t?void 0:null===(e=t.toLowerCase)||void 0===e?void 0:e.call(t),n=et.filter(e=>e&&e.toLowerCase()!==s);return console.log("\uD83D\uDD0D COMPREHENSIVE: Proposal signer state",{matchId:new URLSearchParams(window.location.search).get("matchId"),raw:null==L?void 0:L.proposalSigners,normalized:et,playerOnly:n,feeWallet:s,needsSignatures:null==L?void 0:L.needsSignatures,proposalId:null==L?void 0:L.proposalId,proposalStatus:null==L?void 0:L.proposalStatus,timestamp:new Date().toISOString(),action:"calculating_player_signers"}),n},[et,null==L?void 0:L.proposalSigners,null==L?void 0:L.needsSignatures]),loadPayoutData=async()=>{let e=C.query.matchId;if(e)try{let m=x.env.NEXT_PUBLIC_API_URL,g=await fetch("".concat(m,"/api/match/status/").concat(e,"?wallet=").concat(null==k?void 0:k.toString()),{credentials:"include",headers:{"Content-Type":"application/json"}});if(g.ok){let m=await g.json();console.log("\uD83D\uDD0D CRITICAL DEBUG: Raw API response data:",{matchId:e,payoutProposalId:m.payoutProposalId,tieRefundProposalId:m.tieRefundProposalId,proposalStatus:m.proposalStatus,proposalSigners:m.proposalSigners,needsSignatures:m.needsSignatures,winner:m.winner,isCompleted:m.isCompleted,status:m.status});let x=m.player1Result&&m.player2Result,b=m.isCompleted||x;if(b){var t,s,n,o,l,a,r,i,d,u,c,p;let g=(null==k?void 0:k.toString())===m.player1,b=g?m.player1Result:m.player2Result,f=g?m.player2Result:m.player1Result,v=m.bonus||{},y=m.solPriceAtTransaction?Number(m.solPriceAtTransaction):m.entryFeeUSD&&m.entryFee?Number(m.entryFeeUSD)/Number(m.entryFee):void 0,S=v.amountSol?Number(v.amountSol):0,w=v.amountUSD?Number(v.amountUSD):0,N=v.tier&&h[v.tier]?h[v.tier]:w,D=N&&y?N/y:S,j=m.payoutProposalId||m.tieRefundProposalId;console.log("\uD83D\uDD0D CRITICAL DEBUG: Proposal ID extraction:",{matchId:e,payoutProposalId:m.payoutProposalId,tieRefundProposalId:m.tieRefundProposalId,extractedProposalId:j,proposalStatus:m.proposalStatus,winner:m.winner});let A={won:m.winner===(null==k?void 0:k.toString())&&"tie"!==m.winner,isTie:"tie"===m.winner,winner:m.winner,numGuesses:(null==b?void 0:b.numGuesses)||0,entryFee:m.entryFee||0,timeElapsed:b?"".concat(Math.floor(b.totalTime/1e3),"s"):"N/A",opponentTimeElapsed:f?"".concat(Math.floor(f.totalTime/1e3),"s"):"N/A",opponentGuesses:(null==f?void 0:f.numGuesses)||0,winnerAmount:(null===(t=m.payout)||void 0===t?void 0:t.winnerAmount)||0,feeAmount:(null===(s=m.payout)||void 0===s?void 0:s.feeAmount)||0,refundAmount:(null===(n=m.payout)||void 0===n?void 0:n.refundAmount)||0,isWinningTie:(null===(o=m.payout)||void 0===o?void 0:o.isWinningTie)||!1,feeWallet:(null===(l=m.payout)||void 0===l?void 0:l.feeWallet)||"",transactions:(null===(a=m.payout)||void 0===a?void 0:a.transactions)||[],vaultAddress:m.squadsVaultAddress||m.vaultAddress,vaultDepositAddress:m.squadsVaultPda||m.vaultPda||null,proposalId:j,proposalStatus:m.proposalStatus,proposalSigners:normalizeProposalSigners(m.proposalSigners),needsSignatures:m.needsSignatures||0,proposalExecutedAt:m.proposalExecutedAt,proposalTransactionId:m.proposalTransactionId,automatedPayout:(null===(r=m.payout)||void 0===r?void 0:r.paymentSuccess)||!1,payoutSignature:(null===(u=m.payout)||void 0===u?void 0:null===(d=u.transactions)||void 0===d?void 0:null===(i=d[0])||void 0===i?void 0:i.signature)||m.proposalTransactionId||null,bonus:{eligible:N>0,paid:!!v.paid,amountSol:S,amountUSD:w,percent:v.percent?Number(v.percent):0,tier:v.tier||null,signature:v.signature||null,paidAt:v.paidAt?new Date(v.paidAt):null,expectedUSD:N||0,expectedSol:D||0},totalPayoutSol:m.winner===(null==k?void 0:k.toString())&&"tie"!==m.winner?((null===(c=m.payout)||void 0===c?void 0:c.winnerAmount)||0)+S:(null===(p=m.payout)||void 0===p?void 0:p.winnerAmount)||0,refundReason:m.refundReason||null,matchOutcome:m.matchOutcome||m.status||null,rawStatus:m.status||null};U(A),W(!1);let E=shouldContinuePolling(A);console.log("\uD83D\uDD04 Polling Decision (API):",{matchId:C.query.matchId,keepPolling:E,proposalId:A.proposalId,proposalStatus:A.proposalStatus,bothPlayersHaveResults:x,isPolling:V,extractedProposalId:j}),q(E),E?A.proposalId||q(!0):stopRefreshLoops();let I=es.includes((null==k?void 0:k.toString())||""),P=A.proposalId&&!I&&"EXECUTED"!==A.proposalStatus&&!A.proposalExecutedAt;P&&(console.log("\uD83D\uDD04 Proposal is available but user hasn't signed yet - triggering page refresh",{proposalId:A.proposalId,needsSignatures:A.needsSignatures,proposalStatus:A.proposalStatus,userHasSigned:I,proposalExecutedAt:A.proposalExecutedAt}),setTimeout(()=>{window.location.reload()},500));return}console.log("⏳ Game not yet completed, falling back to localStorage")}else console.error("❌ Failed to fetch match data from backend, falling back to localStorage",{status:g.status,statusText:g.statusText})}catch(e){console.error("❌ Error fetching match data, falling back to localStorage:",e)}let m=localStorage.getItem("payoutData");if(m)try{let e=JSON.parse(m);e.isTie&&void 0===e.isWinningTie&&(e.isWinningTie=!1),e.bonus||(e.bonus={eligible:!1,paid:!1,amountSol:0,amountUSD:0,percent:0,tier:null,signature:null,paidAt:null,expectedUSD:0,expectedSol:0}),void 0===e.matchOutcome&&(e.matchOutcome=null),void 0===e.refundReason&&(e.refundReason=null),U(e),W(!1);let t=shouldContinuePolling(e);console.log("\uD83D\uDD04 Polling Decision (API):",{matchId:C.query.matchId,keepPolling:t,proposalId:e.proposalId,proposalStatus:e.proposalStatus,bothPlayersHaveResults:e.player1Result&&e.player2Result,isPolling:V}),q(t),t?e.proposalId||q(!0):stopRefreshLoops();return}catch(e){console.error("❌ Error parsing stored payout data:",e)}if(!e){M("No match ID provided"),W(!1),q(!1);return}m||M("Failed to load game results"),W(!1),e?(q(!0),console.log("\uD83D\uDD04 Starting polling for proposal creation (matchId present but no proposalId yet)",{matchId:e,hasStoredData:!!m})):(q(!1),stopRefreshLoops())};(0,o.useEffect)(()=>{if(!k){C.push("/");return}loadPayoutData()},[k,C]),(0,o.useEffect)(()=>{if(!V||!C.query.matchId||!k)return;console.log("\uD83D\uDD04 Starting proposal polling (aggressive: 1s for 30s, then 2s)...",{matchId:C.query.matchId,hasProposalId:!!(null==L?void 0:L.proposalId),bothPlayersHaveResults:!!((null==L?void 0:L.player1Result)&&(null==L?void 0:L.player2Result))});let e=0,t=setInterval(()=>{e++;let s=e<=30;if(console.log("\uD83D\uDD04 Polling for proposal updates...",{matchId:C.query.matchId,hasProposalId:!!(null==L?void 0:L.proposalId),pollCount:e,interval:s?1e3:2e3,isAggressive:s}),loadPayoutData(),30===e){clearInterval(t);let e=setInterval(()=>{loadPayoutData()},2e3);Z.current=e}},1e3);return Z.current=t,()=>{console.log("\uD83D\uDED1 Stopping proposal polling"),clearInterval(t),Z.current&&(clearInterval(Z.current),Z.current=null)}},[V,C.query.matchId,k]),(0,o.useEffect)(()=>{let fetchPrice=async()=>{try{let e=x.env.NEXT_PUBLIC_API_URL||"https://guess5.onrender.com",t=await fetch("".concat(e,"/api/match/sol-price"));if(t.ok){let e=await t.json();e.price&&"number"==typeof e.price&&e.price>0&&Q(e.price)}}catch(e){console.error("❌ Failed to fetch SOL price:",e)}};fetchPrice()},[]),(0,o.useEffect)(()=>{let fetchBonusAmount=async()=>{var e,t;if((null==L?void 0:L.proposalStatus)==="EXECUTED"&&(null==L?void 0:null===(e=L.bonus)||void 0===e?void 0:e.signature)&&(null==L?void 0:null===(t=L.bonus)||void 0===t?void 0:t.eligible)&&k&&!H)try{let e=new r.Connection(x.env.NEXT_PUBLIC_SOLANA_NETWORK||"https://api.devnet.solana.com"),t=await e.getTransaction(L.bonus.signature,{commitment:"confirmed",maxSupportedTransactionVersion:0});if(t&&t.meta&&!t.meta.err){let e;let s=t.transaction.message;e="accountKeys"in s?s.accountKeys:"getAccountKeys"in s&&"function"==typeof s.getAccountKeys?s.getAccountKeys().staticAccountKeys:s.staticAccountKeys||[];let n=k.toString(),o=e.findIndex(e=>e.toString()===n);if(-1!==o){let e=t.meta.preBalances[o]||0,s=t.meta.postBalances[o]||0,n=s-e;if(n>0){let e=n/r.LAMPORTS_PER_SOL;J(e)}}}}catch(e){console.error("❌ Failed to fetch bonus transaction:",e)}};fetchBonusAmount()},[null==L?void 0:L.proposalStatus,null==L?void 0:null===(e=L.bonus)||void 0===e?void 0:e.signature,null==L?void 0:null===(t=L.bonus)||void 0===t?void 0:t.eligible,k,H]),(0,o.useEffect)(()=>{L&&console.log("\uD83D\uDCB0 Payout data in render:",{won:L.won,isTie:L.isTie,isWinningTie:L.isWinningTie,refundAmount:L.refundAmount,proposalId:L.proposalId,bonus:L.bonus})},[L]);let handlePlayAgain=()=>{localStorage.removeItem("matchId"),localStorage.removeItem("word"),localStorage.removeItem("payoutData"),C.push("/lobby")},handleSignProposal=async()=>{if(!(null==L?void 0:L.proposalId)||!(null==L?void 0:L.vaultAddress)||!k||!O){M("Missing required data for proposal signing");return}G(!0),M(null);try{let c=C.query.matchId,p=x.env.NEXT_PUBLIC_API_URL||"";console.log("\uD83D\uDD8A️ Preparing to sign proposal",{matchId:c,wallet:k.toString(),proposalId:L.proposalId,vaultAddress:L.vaultAddress,vaultDepositAddress:L.vaultDepositAddress});let m=await fetch("".concat(p,"/api/match/get-proposal-approval-transaction?matchId=").concat(c,"&wallet=").concat(k.toString()));if(!m.ok){let e=await m.json();throw Error(e.error||"Failed to get approval transaction")}let h=await m.json(),{VersionedTransaction:b}=await Promise.resolve().then(s.bind(s,3182)),f=g.from(h.transaction,"base64"),v=b.deserialize(f),y=await O(v),S=y.serialize(),w=g.from(S).toString("base64");console.log("✅ Proposal transaction signed",{matchId:c,wallet:k.toString(),proposalId:L.proposalId}),console.log("\uD83D\uDCE4 Submitting signed proposal transaction to backend",{matchId:c,wallet:k.toString(),proposalId:L.proposalId,hasProposalTx:!!w});let N=await fetch("".concat(p,"/api/match/sign-proposal"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({matchId:c,wallet:k.toString(),signedTransaction:w})});if(!N.ok){let e;let t=await N.text();try{e=JSON.parse(t)}catch(s){e={error:t||"Unknown error"}}throw console.error("❌ Backend sign-proposal failed",{matchId:c,wallet:k.toString(),status:N.status,statusText:N.statusText,error:e.error||e,responseHeaders:Object.fromEntries(N.headers.entries())}),Error(e.error||"Failed to sign proposal: ".concat(N.status," ").concat(N.statusText))}let D=await N.json();if(console.log("✅ Proposal signed & backend confirmed",{matchId:c,wallet:k.toString(),proposalId:L.proposalId,response:D,backendStatus:N.status}),c&&k)try{let s=await fetch("".concat(p,"/api/match/status/").concat(c,"?wallet=").concat(k.toString()));if(s.ok){let c=await s.json(),p=c.player1Result&&c.player2Result,m=c.isCompleted||p;if(m){var e,t,n,o,l,a,r,i,d,u;let s=k.toString()===c.player1,p=s?c.player1Result:c.player2Result,m=s?c.player2Result:c.player1Result,x={...L,won:c.winner===k.toString()&&"tie"!==c.winner,isTie:"tie"===c.winner,winner:c.winner,numGuesses:(null==p?void 0:p.numGuesses)||0,entryFee:c.entryFee||.1104,timeElapsed:p?"".concat(Math.floor(p.totalTime/1e3),"s"):"N/A",opponentTimeElapsed:m?"".concat(Math.floor(m.totalTime/1e3),"s"):"N/A",opponentGuesses:(null==m?void 0:m.numGuesses)||0,winnerAmount:(null===(e=c.payout)||void 0===e?void 0:e.winnerAmount)||0,feeAmount:(null===(t=c.payout)||void 0===t?void 0:t.feeAmount)||0,refundAmount:(null===(n=c.payout)||void 0===n?void 0:n.refundAmount)||0,isWinningTie:(null===(o=c.payout)||void 0===o?void 0:o.isWinningTie)||!1,feeWallet:(null===(l=c.payout)||void 0===l?void 0:l.feeWallet)||"",transactions:(null===(a=c.payout)||void 0===a?void 0:a.transactions)||[],proposalId:c.payoutProposalId||c.tieRefundProposalId,proposalStatus:c.proposalStatus,proposalSigners:normalizeProposalSigners(c.proposalSigners),needsSignatures:c.needsSignatures||0,proposalExecutedAt:c.proposalExecutedAt,proposalTransactionId:c.proposalTransactionId,automatedPayout:(null===(r=c.payout)||void 0===r?void 0:r.paymentSuccess)||!1,payoutSignature:(null===(u=c.payout)||void 0===u?void 0:null===(d=u.transactions)||void 0===d?void 0:null===(i=d[0])||void 0===i?void 0:i.signature)||c.proposalTransactionId||null,refundReason:c.refundReason||null,matchOutcome:c.matchOutcome||c.status||null,rawStatus:c.status||null};U(x),console.log("\uD83D\uDE80 Starting aggressive polling (1s interval) for 10 seconds after signing...");let g=0,h=setInterval(()=>{++g>=10?(clearInterval(h),console.log("✅ Aggressive polling complete, returning to normal polling")):loadPayoutData()},1e3);setTimeout(()=>{clearInterval(h)},1e4)}}else console.warn("⚠️ Failed to refresh status after signing (non-critical)",{status:s.status,statusText:s.statusText})}catch(e){console.warn("⚠️ Error refreshing status after signing (non-critical):",e)}}catch(t){console.error("❌ Error signing proposal:",t);let e=t instanceof Error?t.message:"Failed to sign proposal";e.includes("Failed to fetch")||e.includes("CORS")?console.warn("⚠️ Network/CORS error after signing - signing may have succeeded, check status"):M(e)}finally{G(!1)}};if(_)return(0,n.jsx)("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-white text-xl",children:"Loading results..."})});if(B)return(0,n.jsx)("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:(0,n.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20 max-w-md w-full mx-4",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-red-400 text-xl mb-4",children:"❌ Error"}),(0,n.jsx)("p",{className:"text-white/80 mb-6",children:B}),(0,n.jsx)("button",{onClick:handlePlayAgain,className:"bg-accent hover:bg-accent/80 text-white px-6 py-2 rounded-lg transition-colors",children:"Back to Lobby"})]})})});if(!L)return(0,n.jsx)("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:(0,n.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20 max-w-md w-full mx-4",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-yellow-400 text-xl mb-4",children:"⚠️ No Results"}),(0,n.jsx)("p",{className:"text-white/80 mb-6",children:"No game results found."}),(0,n.jsx)("button",{onClick:handlePlayAgain,className:"bg-accent hover:bg-accent/80 text-white px-6 py-2 rounded-lg transition-colors",children:"Back to Lobby"})]})})});let en=(null==k?void 0:k.toString())||"",eo="cancelled"===L.matchOutcome||"cancelled"===L.winner||!!L.refundReason&&!L.won&&!L.isTie&&L.winner!==en,el=(()=>{if(!L.refundReason)return null;switch(L.refundReason){case"payment_timeout":return"Opponent payment timeout";case"player_cancelled_after_payment":return"Opponent cancelled after payment";case"player_cancelled_before_payment":return"Opponent cancelled before payment";default:return L.refundReason.replace(/_/g," ")}})(),ea=(()=>{if(!eo)return"";switch(L.refundReason){case"payment_timeout":return"Opponent never completed their deposit. Refund proposal is queued below.";case"player_cancelled_after_payment":return"Opponent cancelled after escrow. Sign the refund proposal once it appears.";case"player_cancelled_before_payment":return"Match ended before funds moved into escrow. No SOL left your wallet.";default:return"Match ended before play could begin. Refund details are outlined below."}})(),er="number"==typeof L.refundAmount&&L.refundAmount>0,ei=eo?{emoji:"\uD83D\uDCB8",title:"Match Cancelled",subtitle:ea,background:"from-yellow-500/20 via-amber-500/10 to-amber-400/10",border:"border-yellow-400/40",accentText:"text-yellow-300"}:L.won?{emoji:"\uD83C\uDFC6",title:"Victory Secured",subtitle:"You outguessed your opponent. Sign the proposal below to sweep the vault.",background:"from-green-500/20 via-emerald-500/10 to-green-400/10",border:"border-green-400/40",accentText:"text-green-300"}:L.isTie?{emoji:"\uD83E\uDD1D",title:L.isWinningTie?"Perfectly Matched":"Deadlock Draw",subtitle:L.isWinningTie?"Both players landed identical runs. Refund details are below.":"Neither player cracked the puzzle this round. Refunds are queued below.",background:"from-blue-500/20 via-purple-500/10 to-indigo-500/10",border:"border-blue-400/40",accentText:"text-blue-300"}:{emoji:"\uD83D\uDD25",title:"Tough Loss",subtitle:"Your opponent outguessed you. Sign below to finalize the payout and queue again.",background:"from-red-500/15 via-orange-500/10 to-rose-500/10",border:"border-red-400/40",accentText:"text-red-300"},parseSeconds=e=>{if(!e)return null;let t=e.toString().trim().toLowerCase();if("n/a"===t)return null;let s=parseInt(t.replace("s",""),10);return Number.isFinite(s)?s:null},ed=parseSeconds(L.timeElapsed),eu=parseSeconds(L.opponentTimeElapsed),ec=null;if(eo)ec=ea||"Match ended before any moves were recorded.";else if(null!==ed&&null!==eu){let e=Math.abs(ed-eu);ec=e>0?ed<eu?"You solved it ".concat(e,"s faster."):"Opponent finished ".concat(e,"s quicker."):L.isTie&&L.isWinningTie?"Both players matched pace exactly.":null}return(0,n.jsxs)("div",{className:"min-h-screen bg-primary relative",children:[(0,n.jsx)(c.F,{}),(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,n.jsx)("div",{className:"flex justify-center mb-8",children:(0,n.jsx)("div",{className:"logo-shell",children:(0,n.jsx)(d(),{src:u.Z,alt:"Guess5 Logo",width:220,height:220,priority:!0})})}),(0,n.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-white mb-6",children:"Match Recap"}),(0,n.jsx)("div",{className:"mb-6 rounded-3xl border ".concat(ei.border," bg-gradient-to-br ").concat(ei.background," px-6 py-8 sm:px-8 sm:py-10 shadow-xl"),children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center",children:[(0,n.jsx)("div",{className:"text-4xl sm:text-5xl",children:ei.emoji}),(0,n.jsx)("h2",{className:"text-2xl sm:text-3xl font-black tracking-tight text-white",children:ei.title}),(0,n.jsx)("p",{className:"text-white/70 text-sm sm:text-base max-w-md",children:ei.subtitle})]})}),eo?(0,n.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-yellow-500/40 bg-yellow-500/10 p-5 text-left",children:[(0,n.jsx)("div",{className:"text-white/60 text-xs uppercase tracking-[0.3em] mb-2",children:"Status"}),(0,n.jsx)("div",{className:"text-white font-semibold text-base",children:ea}),L.refundAmount?(0,n.jsxs)("div",{className:"text-yellow-200 text-sm font-semibold mt-3",children:["Refund amount: ",L.refundAmount.toFixed(4)," SOL"]}):(0,n.jsx)("div",{className:"text-white/60 text-xs mt-3",children:"No funds left escrow, so no refund is required."})]}),(0,n.jsx)("div",{className:"rounded-2xl border border-white/10 bg-white/[0.04] px-5 py-4",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm",children:[(0,n.jsx)("span",{className:"text-white/60 uppercase tracking-[0.25em] text-xs",children:"Next Steps"}),(0,n.jsx)("span",{className:"text-sm font-semibold ".concat(ei.accentText),children:ec||"Monitor the proposal below to reclaim your SOL."})]})})]}):(0,n.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,n.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5 text-left",children:[(0,n.jsx)("div",{className:"text-white/50 text-xs uppercase tracking-[0.3em] mb-2",children:"Your Run"}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-white/60 text-xs",children:"Guesses Used"}),(0,n.jsxs)("div",{className:"text-white text-2xl font-semibold",children:[L.numGuesses||0,"/7"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-white/60 text-xs",children:"Time to Solve"}),(0,n.jsx)("div",{className:"text-white text-lg font-medium",children:L.timeElapsed||"—"})]})]})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5 text-left",children:[(0,n.jsx)("div",{className:"text-white/50 text-xs uppercase tracking-[0.3em] mb-2",children:"Opponent"}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-white/60 text-xs",children:"Guesses Used"}),(0,n.jsxs)("div",{className:"text-white text-2xl font-semibold",children:[L.opponentGuesses||0,"/7"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-white/60 text-xs",children:"Time to Solve"}),(0,n.jsx)("div",{className:"text-white text-lg font-medium",children:L.opponentTimeElapsed||"—"})]})]})]})]}),L.isTie&&L.isWinningTie&&(0,n.jsx)("div",{className:"rounded-2xl border border-white/10 bg-white/[0.04] px-5 py-4",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm",children:[(0,n.jsx)("span",{className:"text-white/60 uppercase tracking-[0.25em] text-xs",children:"Tie Breaker"}),(0,n.jsx)("span",{className:"text-sm font-semibold ".concat(ei.accentText),children:ec||"Timing data will appear once both players finish."})]})})]}),z&&(0,n.jsx)("div",{className:"mb-4 bg-accent/20 border border-accent rounded-lg p-4 text-center animate-pulse",children:(0,n.jsx)("p",{className:"text-accent font-semibold text-lg",children:z})}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-accent mb-3",children:"Payout Details"}),L&&L.proposalId?(0,n.jsx)("div",{className:"\n                    ".concat(L.won&&"EXECUTED"===L.proposalStatus?"bg-gradient-to-br from-accent/20 to-yellow-500/20 border-2 border-accent shadow-lg shadow-accent/50":L.isTie&&"EXECUTED"===L.proposalStatus?"bg-gradient-to-br from-blue-500/20 to-purple-500/20 border-2 border-blue-400 shadow-lg shadow-blue-400/50":eo&&"EXECUTED"===L.proposalStatus?"bg-gradient-to-br from-yellow-500/20 to-amber-400/20 border-2 border-yellow-400 shadow-lg shadow-yellow-400/50":L.won||"EXECUTED"!==L.proposalStatus?eo?"bg-yellow-500/10 border border-yellow-400/40":"bg-secondary bg-opacity-10 border border-accent":"bg-gradient-to-br from-gray-500/20 to-gray-600/20 border-2 border-gray-400 shadow-lg shadow-gray-400/50"," rounded-lg p-6 transform transition-all duration-300\n                    ").concat((L.won||L.isTie||!L.won)&&"EXECUTED"===L.proposalStatus?"animate-pulse hover:scale-105":"","\n                  "),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-accent text-lg font-semibold mb-2",children:"\uD83D\uDCB0 Non-Custodial Payout System"}),eo?(0,n.jsxs)("div",{className:"text-white",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-yellow-300 mb-3 animate-bounce",children:"\uD83D\uDCB8 REFUND MODE"}),(0,n.jsx)("p",{className:"text-white/90 mb-3 font-semibold",children:ea}),er?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,n.jsx)("div",{className:"text-white/60 text-xs uppercase tracking-[0.25em] mb-1",children:"Entry Fee Paid"}),(0,n.jsxs)("div",{className:"text-white text-lg font-semibold",children:[(null===(i=L.entryFee)||void 0===i?void 0:i.toFixed(4))||"0.0000"," SOL",$&&L.entryFee&&(0,n.jsxs)("span",{className:"text-white/60 text-sm ml-2",children:["($",(L.entryFee*$).toFixed(2)," USD)"]})]})]}),(0,n.jsxs)("div",{className:"text-3xl font-bold text-yellow-400 mb-2",children:[null===(p=L.refundAmount)||void 0===p?void 0:p.toFixed(4)," SOL",$&&L.refundAmount&&(0,n.jsxs)("span",{className:"text-yellow-300 text-xl ml-2",children:["($",(L.refundAmount*$).toFixed(2)," USD)"]})]}),L.entryFee&&L.refundAmount&&(0,n.jsx)("div",{className:"text-sm mb-2 ".concat(1e-4>Math.abs(L.entryFee-L.refundAmount)?"text-green-400":"text-yellow-400"),children:1e-4>Math.abs(L.entryFee-L.refundAmount)?"✅ Full refund verified":"⚠️ Refund differs from entry fee by ".concat(Math.abs(L.entryFee-L.refundAmount).toFixed(4)," SOL")})]}):(0,n.jsx)("div",{className:"text-white/70 text-sm mb-2",children:"No escrow transfer occurred, so no refund needs to be signed."}),"EXECUTED"===L.proposalStatus?(0,n.jsx)("div",{className:"text-green-400 text-xl font-semibold animate-pulse mb-3",children:"✅ Refund returned to your wallet!"}):er?(0,n.jsx)("p",{className:"text-sm text-white/80 mb-3",children:"Sign the refund proposal below to release your SOL back to your wallet."}):null,el&&(0,n.jsxs)("div",{className:"text-white/50 text-xs uppercase tracking-[0.25em] mt-2",children:["Reason: ",el]}),("ACTIVE"===L.proposalStatus||"PROPOSAL_CREATED"===L.proposalStatus||!L.proposalStatus||"PENDING"===L.proposalStatus)&&(void 0===L.needsSignatures||null===L.needsSignatures||L.needsSignatures>=0)&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"text-sm mb-2 ".concat(0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?(es.includes((null==k?void 0:k.toString())||"")||es.length,"text-green-400 font-semibold"):es.includes((null==k?void 0:k.toString())||"")?"text-yellow-400":es.length>0?"text-green-400 font-semibold":"text-white/60"),children:0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?es.includes((null==k?void 0:k.toString())||"")?"✓ You have signed. Waiting for refund execution...":es.length>0?"\uD83C\uDF89 Other player has signed! Refund is executing shortly.":"✅ Refund proposal is ready to execute - waiting for processing...":es.includes((null==k?void 0:k.toString())||"")?"✓ You have signed. Waiting for refund execution...":es.length>0?"\uD83C\uDF89 Other player has signed! Refund will execute soon. No action needed.":"⏳ Waiting for either player to sign the refund (only one signature needed)..."}),L.proposalId&&!es.includes((null==k?void 0:k.toString())||"")&&(0,n.jsx)("button",{onClick:handleSignProposal,disabled:X,className:"bg-accent hover:bg-yellow-600 disabled:bg-gray-600 text-black font-bold py-2 px-6 rounded-lg transition-colors",children:X?"Signing...":"Sign Refund Proposal"})]})]}):L.won?(0,n.jsxs)("div",{className:"text-white",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-accent mb-3 animate-bounce",children:"\uD83C\uDF89 YOU WON! \uD83C\uDF89"}),(0,n.jsxs)("div",{className:"mb-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,n.jsx)("div",{className:"text-white/60 text-xs uppercase tracking-[0.25em] mb-1",children:"Entry Fee Paid"}),(0,n.jsxs)("div",{className:"text-white text-lg font-semibold",children:[(null===(b=L.entryFee)||void 0===b?void 0:b.toFixed(4))||"0.0000"," SOL",$&&L.entryFee&&(0,n.jsxs)("span",{className:"text-white/60 text-sm ml-2",children:["($",(L.entryFee*$).toFixed(2)," USD)"]})]})]}),(0,n.jsxs)("div",{className:"text-4xl font-bold text-yellow-400 mb-2",children:[null===(f=L.winnerAmount)||void 0===f?void 0:f.toFixed(4)," SOL"]}),L.entryFee&&L.winnerAmount&&(0,n.jsx)("div",{className:"text-sm mb-2 ".concat(1e-4>Math.abs(L.winnerAmount-(2*L.entryFee-(L.feeAmount||0)))?"text-green-400":"text-yellow-400"),children:1e-4>Math.abs(L.winnerAmount-(2*L.entryFee-(L.feeAmount||0)))?"✅ Payout verified: ".concat((2*L.entryFee).toFixed(4)," SOL (both entry fees) - ").concat((L.feeAmount||0).toFixed(4)," SOL (platform fee) = ").concat(L.winnerAmount.toFixed(4)," SOL"):"⚠️ Payout verification: Expected ~".concat((2*L.entryFee-(L.feeAmount||0)).toFixed(4)," SOL, got ").concat(L.winnerAmount.toFixed(4)," SOL")}),(null===(v=L.bonus)||void 0===v?void 0:v.eligible)?(0,n.jsx)("div",{className:"mb-3 rounded-2xl px-4 py-3 border ".concat(L.bonus.paid?"bg-green-500/15 border-green-400/40":"bg-yellow-500/10 border-yellow-400/40"),children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 font-semibold",children:[(0,n.jsx)("span",{className:"text-xl",children:"\uD83C\uDF81"}),(0,n.jsx)("span",{className:"text-white/90 uppercase tracking-wide",children:"House Bonus"})]}),L.bonus.paid?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-green-300 font-bold text-lg",children:["+",null===(y=L.bonus.amountSol)||void 0===y?void 0:y.toFixed(4)," SOL",L.bonus.amountUSD?" ($".concat(L.bonus.amountUSD.toFixed(2),")"):""]}),L.totalPayoutSol&&(0,n.jsxs)("div",{className:"text-white/70 text-xs",children:["Total received: ",L.totalPayoutSol.toFixed(4)," SOL",$&&" ($".concat((L.totalPayoutSol*$).toFixed(2)," USD)")]}),L.bonus.signature&&(0,n.jsx)("a",{href:"https://explorer.solana.com/tx/".concat(L.bonus.signature,"?cluster=devnet"),target:"_blank",rel:"noreferrer",className:"text-accent text-xs underline hover:text-yellow-300",children:"View bonus transaction ↗"})]}):(0,n.jsxs)("div",{className:"text-yellow-300 text-sm text-center",children:["Bonus triggered! +",null===(S=L.bonus.expectedSol)||void 0===S?void 0:S.toFixed(4)," SOL arriving when the proposal executes."]})]})}):(0,n.jsx)("div",{className:"text-white/40 text-xs mb-3",children:"Play higher tiers to unlock our house bonus boosts."}),"EXECUTED"===L.proposalStatus?(0,n.jsxs)("div",{className:"text-green-400 text-xl font-semibold animate-pulse mb-3",children:["✅ Payment Sent to Your Wallet!",(null===(w=L.bonus)||void 0===w?void 0:w.eligible)&&null!==H&&(0,n.jsxs)("div",{className:"text-green-300 text-sm mt-2",children:["Bonus: +",H.toFixed(4)," SOL",$&&" (+$".concat((H*$).toFixed(2)," USD)")]})]}):(0,n.jsxs)("p",{className:"text-sm text-white/80 mb-3",children:["You must sign to claim your winnings before starting a new game. Sign the proposal below to receive your payout.",(null===(N=L.bonus)||void 0===N?void 0:N.eligible)&&(null===(D=L.bonus)||void 0===D?void 0:D.expectedSol)&&(0,n.jsxs)("span",{className:"block mt-1 text-yellow-300",children:["Bonus: +",L.bonus.expectedSol.toFixed(4)," SOL",$&&" (+$".concat((L.bonus.expectedSol*$).toFixed(2)," USD)")," will be sent when proposal executes."]})]}),("ACTIVE"===L.proposalStatus||"PROPOSAL_CREATED"===L.proposalStatus||!L.proposalStatus||"PENDING"===L.proposalStatus)&&(void 0===L.needsSignatures||null===L.needsSignatures||L.needsSignatures>=0)&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"text-sm mb-2 ".concat(0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?"text-green-400 font-semibold":es.includes((null==k?void 0:k.toString())||"")?"text-yellow-400":es.length>0?"text-green-400 font-semibold":"text-white/60"),children:0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?es.includes((null==k?void 0:k.toString())||"")?"✓ You have signed. Waiting for proposal execution...":es.length>0?"\uD83C\uDF89 Other player has signed! Proposal is ready to execute. No action needed from you.":"✅ Proposal is ready to execute - waiting for processing...":es.includes((null==k?void 0:k.toString())||"")?"✓ You have signed. Waiting for proposal execution...":"⏳ Waiting for either player to sign (only 1 signature needed)..."}),(()=>{let e=!!L.proposalId,t=es.includes((null==k?void 0:k.toString())||""),s=e&&!t;return console.log("\uD83D\uDD0D WINNER Sign Button Debug:",{hasProposalId:e,proposalId:L.proposalId,userHasSigned:t,playerProposalSigners:es,publicKey:null==k?void 0:k.toString(),shouldShowButton:s,proposalStatus:L.proposalStatus,needsSignatures:L.needsSignatures}),s?(0,n.jsx)("button",{onClick:handleSignProposal,disabled:X,className:"bg-accent hover:bg-yellow-400 disabled:bg-gray-600 disabled:cursor-not-allowed text-primary font-bold py-2.5 px-6 rounded-lg transition-all duration-200 shadow hover:shadow-lg transform hover:scale-105 active:scale-95 min-h-[44px] flex items-center justify-center mx-auto",children:X?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"}),"Signing..."]}):"Sign to Claim Winnings"}):null})()]})]}):L.isTie?(0,n.jsxs)("div",{className:"text-white",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-accent mb-3 animate-bounce",children:"\uD83E\uDD1D IT'S A TIE! \uD83E\uDD1D"}),L.isWinningTie?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,n.jsx)("div",{className:"text-white/60 text-xs uppercase tracking-[0.25em] mb-1",children:"Entry Fee Paid"}),(0,n.jsxs)("div",{className:"text-white text-lg font-semibold",children:[(null===(j=L.entryFee)||void 0===j?void 0:j.toFixed(4))||"0.0000"," SOL",$&&L.entryFee&&(0,n.jsxs)("span",{className:"text-white/60 text-sm ml-2",children:["($",(L.entryFee*$).toFixed(2)," USD)"]})]})]}),(0,n.jsx)("p",{className:"text-lg text-white/90 mb-2 font-semibold",children:"Perfect Match - Both players solved with same moves and time!"}),(0,n.jsxs)("div",{className:"text-3xl font-bold text-yellow-400 mb-2",children:[(null===(A=L.refundAmount)||void 0===A?void 0:A.toFixed(4))||"0.0000"," SOL",$&&L.refundAmount&&(0,n.jsxs)("span",{className:"text-yellow-300 text-xl ml-2",children:["($",(L.refundAmount*$).toFixed(2)," USD)"]})]}),L.entryFee&&L.refundAmount&&(0,n.jsx)("div",{className:"text-sm mb-2 ".concat(1e-4>Math.abs(L.entryFee-L.refundAmount)?"text-green-400":"text-yellow-400"),children:1e-4>Math.abs(L.entryFee-L.refundAmount)?"✅ Full refund verified":"⚠️ Refund differs from entry fee by ".concat(Math.abs(L.entryFee-L.refundAmount).toFixed(4)," SOL")}),"EXECUTED"===L.proposalStatus?(0,n.jsx)("div",{className:"text-green-400 text-xl font-semibold animate-pulse mb-3",children:"✅ Full Refund Sent to Your Wallet!"}):(0,n.jsx)("p",{className:"text-sm text-white/80 mb-3",children:"You must sign to receive your refund. Full refund: Sign proposal to claim your funds back."})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,n.jsx)("div",{className:"text-white/60 text-xs uppercase tracking-[0.25em] mb-1",children:"Entry Fee Paid"}),(0,n.jsxs)("div",{className:"text-white text-lg font-semibold",children:[(null===(E=L.entryFee)||void 0===E?void 0:E.toFixed(4))||"0.0000"," SOL",$&&L.entryFee&&(0,n.jsxs)("span",{className:"text-white/60 text-sm ml-2",children:["($",(L.entryFee*$).toFixed(2)," USD)"]})]})]}),(0,n.jsx)("p",{className:"text-lg text-white/90 mb-2 font-semibold",children:"Both players failed to solve the puzzle"}),(0,n.jsxs)("div",{className:"text-3xl font-bold text-yellow-400 mb-2",children:[(null===(I=L.refundAmount)||void 0===I?void 0:I.toFixed(4))||"0.0000"," SOL",$&&L.refundAmount&&(0,n.jsxs)("span",{className:"text-yellow-300 text-xl ml-2",children:["($",(L.refundAmount*$).toFixed(2)," USD)"]})]}),L.entryFee&&L.refundAmount&&(0,n.jsx)("div",{className:"text-sm mb-2 ".concat(1e-4>Math.abs(.95*L.entryFee-L.refundAmount)?"text-green-400":"text-yellow-400"),children:1e-4>Math.abs(.95*L.entryFee-L.refundAmount)?"✅ 95% refund verified (".concat((.95*L.entryFee).toFixed(4)," SOL expected)"):"⚠️ Refund differs from expected 95% (".concat((.95*L.entryFee).toFixed(4)," SOL) by ").concat(Math.abs(.95*L.entryFee-L.refundAmount).toFixed(4)," SOL. Entry fee: ").concat(L.entryFee.toFixed(4)," SOL, Refund: ").concat(L.refundAmount.toFixed(4)," SOL")}),"EXECUTED"===L.proposalStatus?(0,n.jsx)("div",{className:"text-green-400 text-xl font-semibold animate-pulse mb-3",children:"✅ 95% Refund Sent to Your Wallet!"}):(0,n.jsx)("p",{className:"text-sm text-white/80 mb-3",children:"You must sign to receive your refund. 95% refund: Sign proposal to claim your funds back."})]}),(null===(P=L.bonus)||void 0===P?void 0:P.eligible)&&(0,n.jsxs)("div",{className:"text-white/50 text-xs mb-3",children:["House bonus sparks only on wins—secure the next ",getBonusTierLabel(L.bonus.tier)," victory to unlock +$",null===(T=L.bonus.expectedUSD)||void 0===T?void 0:T.toFixed(2),"."]}),("ACTIVE"===L.proposalStatus||"PROPOSAL_CREATED"===L.proposalStatus||!L.proposalStatus||"PENDING"===L.proposalStatus)&&(void 0===L.needsSignatures||null===L.needsSignatures||L.needsSignatures>=0)&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"text-sm mb-2 ".concat(0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?"text-green-400 font-semibold":es.includes((null==k?void 0:k.toString())||"")?"text-yellow-400":es.length>0?"text-green-400 font-semibold":"text-white/60"),children:0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?"✅ Proposal is ready to execute - waiting for processing...":es.includes((null==k?void 0:k.toString())||"")?"✓ You have signed. Waiting for proposal execution...":es.length>0?"\uD83C\uDF89 Other player has signed! Proposal is ready to execute. No action needed from you.":"⏳ Waiting for either player to sign (only 1 signature needed)..."}),(()=>{let e=!!L.proposalId,t=es.includes((null==k?void 0:k.toString())||""),s=e&&!t;return console.log("\uD83D\uDD0D TIE Sign Button Debug:",{hasProposalId:e,proposalId:L.proposalId,userHasSigned:t,playerProposalSigners:es,publicKey:null==k?void 0:k.toString(),shouldShowButton:s,proposalStatus:L.proposalStatus,needsSignatures:L.needsSignatures}),s?(0,n.jsx)("button",{onClick:handleSignProposal,disabled:X,className:"bg-accent hover:bg-yellow-600 disabled:bg-gray-600 text-black font-bold py-2 px-6 rounded-lg transition-colors",children:X?"Signing...":"Sign to Claim Refund"}):null})()]})]}):(0,n.jsxs)("div",{className:"text-white",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-red-400 mb-3 animate-pulse",children:"\uD83D\uDE14 YOU LOST"}),(0,n.jsx)("p",{className:"text-lg text-white/90 mb-2 font-semibold",children:"Better luck next time!"}),(null===(F=L.bonus)||void 0===F?void 0:F.eligible)&&(0,n.jsxs)("div",{className:"text-white/50 text-xs mb-3",children:["Win your next ",getBonusTierLabel(L.bonus.tier)," match to grab an extra +$",null===(R=L.bonus.expectedUSD)||void 0===R?void 0:R.toFixed(2)," house bonus."]}),"EXECUTED"===L.proposalStatus?(0,n.jsx)("div",{className:"text-green-400 text-lg font-semibold mb-3",children:"✅ Winner has been paid. You can play again!"}):(0,n.jsx)("p",{className:"text-sm text-white/80 mb-3",children:"You must sign to finalize the payout before starting a new game. Sign the proposal to help process the payout and get back to playing faster."}),("ACTIVE"===L.proposalStatus||"PROPOSAL_CREATED"===L.proposalStatus||!L.proposalStatus||"PENDING"===L.proposalStatus)&&(void 0===L.needsSignatures||null===L.needsSignatures||L.needsSignatures>=0)&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"text-sm mb-2 ".concat(0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?"text-green-400 font-semibold":es.includes((null==k?void 0:k.toString())||"")?"text-yellow-400":es.length>0?"text-green-400 font-semibold":"text-white/60"),children:0===L.needsSignatures||void 0===L.needsSignatures||null===L.needsSignatures?"✅ Proposal is ready to execute - waiting for processing...":es.includes((null==k?void 0:k.toString())||"")?"✓ You have signed. Waiting for proposal execution...":es.length>0?"\uD83C\uDF89 Other player has signed! Proposal is ready to execute. No action needed from you.":"⏳ Waiting for either player to sign (only 1 signature needed)..."}),L.proposalId&&!es.includes((null==k?void 0:k.toString())||"")&&(0,n.jsx)("button",{onClick:handleSignProposal,disabled:X,className:"bg-accent hover:bg-yellow-600 disabled:bg-gray-600 text-black font-bold py-2 px-6 rounded-lg transition-colors",children:X?"Signing...":"Sign Proposal"})]})]}),L.payoutSignature&&(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)("a",{href:"https://explorer.solana.com/tx/".concat(L.payoutSignature,"?cluster=devnet"),target:"_blank",rel:"noopener noreferrer",className:"text-accent hover:text-yellow-400 text-sm underline",children:"View Transaction on Explorer"})})]})}):(0,n.jsx)("div",{className:"bg-secondary bg-opacity-10 border border-accent rounded-lg p-4",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center mb-3",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-accent mr-3"}),(0,n.jsx)("div",{className:"text-accent text-lg font-semibold",children:"⏳ Processing Payout"})]}),(0,n.jsx)("p",{className:"text-white/80 text-sm",children:(null==L?void 0:L.proposalId)?L.needsSignatures>0?"Waiting for ".concat(L.needsSignatures," signature").concat(1!==L.needsSignatures?"s":"","..."):"Proposal ready for execution...":"The payout proposal is being created. Please wait..."}),V&&(0,n.jsx)("p",{className:"text-white/60 text-xs mt-2",children:"Checking for updates..."}),(null==L?void 0:L.proposalId)&&(null==L?void 0:L.needsSignatures)>0&&(0,n.jsxs)("p",{className:"text-white/60 text-xs mt-2",children:[L.needsSignatures," signature",1!==L.needsSignatures?"s":""," needed"]})]})})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-4 items-center",children:[(0,n.jsx)("button",{onClick:handlePlayAgain,className:"bg-accent hover:bg-yellow-400 hover:shadow-lg text-primary px-8 py-3.5 rounded-lg font-bold transition-all duration-200 transform hover:scale-105 active:scale-95 min-h-[52px] flex items-center justify-center",children:"Play Again"}),(0,n.jsxs)("div",{className:"flex gap-3 justify-center items-center mt-2",children:[(0,n.jsxs)("a",{href:"https://discord.gg/CcXWUv7r",target:"_blank",rel:"noopener noreferrer",className:"bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium px-4 py-2 rounded-lg shadow border border-indigo-500/30 hover:border-indigo-400/50 transition-all duration-200 min-h-[36px] flex items-center justify-center gap-1.5",children:[(0,n.jsx)("span",{children:"\uD83D\uDCAC"}),(0,n.jsx)("span",{children:"Discord"})]}),(0,n.jsxs)("a",{href:"https://instagram.com/Guess5.io",target:"_blank",rel:"noopener noreferrer",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-xs font-medium px-4 py-2 rounded-lg shadow border border-purple-500/30 hover:border-purple-400/50 transition-all duration-200 min-h-[36px] flex items-center justify-center gap-1.5",children:[(0,n.jsx)("span",{children:"\uD83D\uDCF7"}),(0,n.jsx)("span",{children:"@Guess5.io"})]})]})]}),(0,n.jsx)("div",{className:"mt-6 pt-4 border-t border-white/10",children:(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-4 text-xs text-white/40",children:[C.query.matchId&&(0,n.jsxs)("span",{className:"font-mono",children:["Match: ",String(C.query.matchId).slice(0,8),"..."]}),(null==L?void 0:L.payoutSignature)&&(0,n.jsxs)("span",{className:"font-mono",children:["TX: ",L.payoutSignature.slice(0,8),"..."]}),(null==L?void 0:L.proposalTransactionId)&&!(null==L?void 0:L.payoutSignature)&&(0,n.jsxs)("span",{className:"font-mono",children:["TX: ",L.proposalTransactionId.slice(0,8),"..."]}),(null==L?void 0:L.refundTxHash)&&(0,n.jsxs)("span",{className:"font-mono",children:["Refund TX: ",L.refundTxHash.slice(0,8),"..."]})]})})]})})]})})]})}},1163:function(e,t,s){e.exports=s(9974)}},function(e){e.O(0,[675,960,774,888,179],function(){return e(e.s=7170)}),_N_E=e.O()}]);